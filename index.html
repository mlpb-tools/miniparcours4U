<!doctype html>
<html lang="fr">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Parcours ThÃ©matiques</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700&amp;family=Poppins:wght@400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: #ffffff;
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      position: relative;
    }

    html, body {
      height: 100%;
    }

    .deco-shapes {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .deco-circle {
      position: absolute;
      border-radius: 50%;
      opacity: 0.12;
    }

    .deco-circle-1 {
      width: 400px;
      height: 400px;
      background: #FF1744;
      top: -100px;
      right: -100px;
    }

    .deco-circle-2 {
      width: 300px;
      height: 300px;
      background: #FFD600;
      bottom: 100px;
      left: -80px;
    }

    .deco-circle-3 {
      width: 200px;
      height: 200px;
      background: #00BFA5;
      top: 40%;
      right: 10%;
    }

    .deco-puzzle {
      position: absolute;
      width: 150px;
      height: 150px;
      opacity: 0.08;
    }

    .puzzle-1 {
      top: 15%;
      left: 5%;
      background: #FF1744;
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    }

    .puzzle-2 {
      bottom: 20%;
      right: 8%;
      background: #00BFA5;
      border-radius: 70% 30% 30% 70% / 70% 70% 30% 30%;
    }

    .floating-dots {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      opacity: 0.2;
    }

    .dot-1 { background: #00BFA5; top: 25%; left: 15%; }
    .dot-2 { background: #FFD600; top: 60%; right: 20%; }
    .dot-3 { background: #B2DFDB; bottom: 30%; left: 25%; width: 15px; height: 15px; }
    .dot-4 { background: #FF1744; top: 45%; left: 8%; width: 12px; height: 12px; }

    .main-container {
      width: 100%;
      min-height: 100%;
      padding: 3rem 2rem 120px 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .logos-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 1000px;
      margin-bottom: 2rem;
      padding: 1rem 0;
      gap: 2rem;
    }

    .logo-left, .logo-right {
      height: 60px;
      object-fit: contain;
    }

    .logo-left {
      max-width: 224px;
    }

    .logo-right {
      max-width: 200px;
    }

    .header {
      text-align: center;
      margin-bottom: 3rem;
      max-width: 900px;
    }

    .main-title {
      font-family: 'Fredoka', sans-serif;
      font-size: 3.5rem;
      font-weight: 700;
      color: #FF1744;
      margin: 0 0 1rem 0;
      line-height: 1.2;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 1.25rem;
      color: #424242;
      margin: 0;
      font-weight: 400;
    }

    .content-card {
      background: #ffffff;
      border-radius: 32px;
      padding: 3rem;
      width: 100%;
      max-width: 1000px;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08);
      position: relative;
      border: 3px solid #F5F5F5;
    }

    .domain-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .domain-card {
      background: #ffffff;
      border-radius: 24px;
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .domain-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, #FF1744, #FFD600, #00BFA5);
    }

    .domain-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
      border-color: #FF1744;
    }

    .domain-card.emploi { border-color: #FF1744; }
    .domain-card.formation { border-color: #00BFA5; }
    .domain-card.orientation { border-color: #FFD600; }
    .domain-card.numerique { border-color: #2196F3; }
    .domain-card.mobilite { border-color: #9C27B0; }
    .domain-card.sante { border-color: #B2DFDB; }
    .domain-card.logement { border-color: #FF1744; }
    .domain-card.citoyennete { border-color: #00BFA5; }
    .domain-card.loisirs { border-color: #00BFA5; }
    .domain-card.finances { border-color: #FFD600; }

    .domain-emoji {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      display: block;
    }

    .domain-title {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: #FF1744;
      margin: 0.75rem 0;
    }

    .domain-subtitle {
      font-size: 1rem;
      color: #757575;
      margin: 0;
      line-height: 1.5;
    }

    .completion-badge {
      display: inline-block;
      background: #00BFA5;
      color: white;
      padding: 0.375rem 1rem;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      margin-top: 1rem;
      font-family: 'Fredoka', sans-serif;
    }

    .progress-indicator {
      background: linear-gradient(135deg, #FFD600 0%, #FFB300 100%);
      border-radius: 20px;
      padding: 1.25rem 1.75rem;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #212121;
      font-weight: 600;
    }

    .activity-header {
      background: linear-gradient(135deg, #FF1744 0%, #D50000 100%);
      color: white;
      padding: 2.5rem;
      border-radius: 24px;
      margin-bottom: 2.5rem;
      position: relative;
      overflow: hidden;
    }

    .activity-header::after {
      content: '';
      position: absolute;
      top: -50px;
      right: -50px;
      width: 200px;
      height: 200px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
    }

    .activity-title {
      font-family: 'Fredoka', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      margin: 0 0 0.75rem 0;
      position: relative;
      z-index: 1;
    }

    .activity-objective {
      font-size: 1.125rem;
      opacity: 0.95;
      margin: 0;
      position: relative;
      z-index: 1;
    }

    .selection-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .selection-card {
      background: #FAFAFA;
      border: 3px solid #E0E0E0;
      border-radius: 20px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .selection-card:hover {
      border-color: #00BFA5;
      background: #F1F8F6;
      transform: scale(1.05);
    }

    .selection-card.selected {
      background: linear-gradient(135deg, #00BFA5 0%, #00897B 100%);
      color: white;
      border-color: #00BFA5;
      transform: scale(1.05);
    }

    .selection-card.like {
      background: linear-gradient(135deg, #00BFA5 0%, #00897B 100%);
      color: white;
      border-color: #00BFA5;
    }

    .selection-card.dislike {
      background: linear-gradient(135deg, #FF4F73 0%, #D50000 100%);
      color: white;
      border-color: #FF4F73;
    }

    .selection-label {
      font-size: 1.05rem;
      font-weight: 500;
      line-height: 1.4;
    }

    .emoji-selector {
      display: flex;
      justify-content: center;
      gap: 3rem;
      margin: 3rem 0;
      flex-wrap: wrap;
    }

    .emoji-option {
      text-align: center;
      cursor: pointer;
      padding: 2rem;
      border-radius: 24px;
      transition: all 0.3s ease;
      border: 3px solid #E0E0E0;
      background: #FAFAFA;
      min-width: 160px;
    }

    .emoji-option:hover {
      background: #F1F8F6;
      border-color: #00BFA5;
      transform: scale(1.1);
    }

    .emoji-option.selected {
      background: linear-gradient(135deg, #FFD600 0%, #FFB300 100%);
      border-color: #FFD600;
      transform: scale(1.1);
    }

    .emoji-large {
      font-size: 5rem;
      margin-bottom: 1rem;
    }

    .emoji-text {
      font-size: 1.05rem;
      font-weight: 600;
      color: #212121;
      font-family: 'Fredoka', sans-serif;
    }

    .flip-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
      perspective: 1000px;
    }

    .flip-card-wrapper {
      height: 200px;
    }

    .flip-card {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      cursor: pointer;
    }

    .flip-card.is-flipped {
      transform: rotateY(180deg);
    }

    .flip-card-front, .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .flip-card-front {
      background: linear-gradient(135deg, #FAFAFA 0%, #E8E8E8 100%);
      border: 3px solid #E0E0E0;
    }

    .flip-card-back {
      background: linear-gradient(135deg, #00BFA5 0%, #00897B 100%);
      color: white;
      transform: rotateY(180deg);
      border: 3px solid #00BFA5;
    }

    .flip-card-content {
      text-align: center;
      padding: 1rem;
    }

    .flip-card:hover .flip-card-front {
      border-color: #00BFA5;
      box-shadow: 0 6px 16px rgba(0, 191, 165, 0.2);
    }

    .scenarios-abc-container {
      margin: 2rem 0;
    }

    .scenario-abc-item {
      margin-bottom: 3rem;
    }

    .scenario-question {
      background: linear-gradient(135deg, #F5F5F5 0%, #EEEEEE 100%);
      padding: 1.75rem;
      border-radius: 20px;
      margin-bottom: 1.5rem;
      border-left: 5px solid #FF1744;
    }

    .scenario-question-text {
      font-weight: 600;
      font-size: 1.125rem;
      color: #212121;
      margin: 0;
      line-height: 1.5;
    }

    .scenario-abc-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .scenario-abc-option {
      background: #FAFAFA;
      border: 3px solid #E0E0E0;
      border-radius: 16px;
      padding: 1.25rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.05rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .scenario-abc-option:hover {
      border-color: #FFD600;
      background: #FFFEF0;
      transform: translateX(8px);
    }

    .scenario-abc-option.selected {
      background: linear-gradient(135deg, #FFD600 0%, #FFB300 100%);
      border-color: #FFD600;
      color: #212121;
      font-weight: 600;
    }

    .scenario-feedback {
      background: #E8F5E9;
      border-left: 4px solid #00BFA5;
      padding: 1.25rem;
      border-radius: 12px;
      margin-top: 1rem;
      font-size: 1rem;
      color: #1B5E20;
      line-height: 1.5;
    }

    .scenario-option {
      background: #FAFAFA;
      border: 3px solid #E0E0E0;
      border-radius: 20px;
      padding: 1.75rem;
      margin-bottom: 1.25rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.05rem;
      line-height: 1.6;
    }

    .scenario-option:hover {
      border-color: #00BFA5;
      background: #F1F8F6;
      transform: translateX(8px);
    }

    .scenario-option.selected {
      background: linear-gradient(135deg, #00BFA5 0%, #00897B 100%);
      color: white;
      border-color: #00BFA5;
      transform: translateX(8px);
    }

    .slider-container {
      margin: 2.5rem 0;
      padding: 2rem;
      background: #FAFAFA;
      border-radius: 20px;
    }

    .slider-label {
      font-weight: 600;
      color: #212121;
      margin-bottom: 1.5rem;
      display: block;
      font-size: 1.125rem;
      font-family: 'Fredoka', sans-serif;
    }

    .slider {
      width: 100%;
      height: 10px;
      border-radius: 10px;
      background: linear-gradient(90deg, #B2DFDB 0%, #00BFA5 100%);
      outline: none;
      margin: 1.5rem 0;
    }

    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #FF1744;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(255, 23, 68, 0.3);
      border: 4px solid white;
    }

    .slider::-moz-range-thumb {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #FF1744;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(255, 23, 68, 0.3);
      border: 4px solid white;
    }

    .slider-values {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      color: #616161;
      font-weight: 500;
    }

    .button-group {
      display: flex;
      gap: 1.5rem;
      margin-top: 3rem;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .btn {
      padding: 1.125rem 2.5rem;
      border: none;
      border-radius: 50px;
      font-size: 1.125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Fredoka', sans-serif;
      letter-spacing: 0.3px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #FF1744 0%, #D50000 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(255, 23, 68, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(255, 23, 68, 0.4);
    }

    .btn-secondary {
      background: #EEEEEE;
      color: #424242;
    }

    .btn-secondary:hover {
      background: #E0E0E0;
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .bottom-capsules {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background: linear-gradient(90deg, #FFD600 0%, #00BFA5 25%, #FF1744 50%, #B2DFDB 75%, #FFD600 100%);
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2rem;
      overflow: hidden;
    }

    .capsule {
      width: 60px;
      height: 30px;
      border-radius: 30px;
      background: white;
      opacity: 0.7;
    }

    .section-title {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      color: #FF1744;
      margin-bottom: 2rem;
    }

    .direction-bubbles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 2rem;
      margin: 2.5rem 0;
    }

    .direction-bubble {
      background: #FAFAFA;
      border: 4px solid #E0E0E0;
      border-radius: 30px;
      padding: 2.5rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }

    .direction-bubble:hover {
      transform: scale(1.08);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    }

    .direction-bubble.selected {
      transform: scale(1.08);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.2);
      color: white;
    }

    .direction-icon {
      font-size: 4.5rem;
      margin-bottom: 1.25rem;
      display: block;
      filter: grayscale(0.3);
    }

    .direction-bubble.selected .direction-icon {
      filter: grayscale(0);
      animation: bounce 0.6s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .direction-label {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .direction-description {
      font-size: 1rem;
      opacity: 0.85;
      line-height: 1.4;
    }

    .category-sorter {
      margin: 2.5rem 0;
    }

    .category-group {
      background: #FAFAFA;
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .category-name {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: #FF1744;
      margin-bottom: 1.5rem;
    }

    .category-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
    }

    @media (max-width: 768px) {
      .logos-container {
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }

      .logo-left, .logo-right {
        height: 50px;
      }

      .main-title {
        font-size: 2.5rem;
      }

      .content-card {
        padding: 2rem;
      }

      .domain-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .emoji-selector {
        gap: 1.5rem;
      }

      .button-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }

      .direction-bubbles {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="deco-shapes">
   <div class="deco-circle deco-circle-1"></div>
   <div class="deco-circle deco-circle-2"></div>
   <div class="deco-circle deco-circle-3"></div>
   <div class="deco-puzzle puzzle-1"></div>
   <div class="deco-puzzle puzzle-2"></div>
   <div class="floating-dots dot-1"></div>
   <div class="floating-dots dot-2"></div>
   <div class="floating-dots dot-3"></div>
   <div class="floating-dots dot-4"></div>
  </div>
  <div class="main-container">
   <div class="logos-container"><img src="https://static.wixstatic.com/media/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif/v1/fill/w_224,h_60,al_c,q_80,enc_avif,quality_auto/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif" alt="Mission Locale" class="logo-left" onerror="this.style.display='none';"> <img src="https://www.lifeskills4youth.eu/wp-content/uploads/2024/07/LS4YOU_Logo.png" alt="LS4YOU" class="logo-right" onerror="this.style.display='none';">
   </div>
   <header class="header">
    <h1 class="main-title" id="mainTitle">Mini Parcours ThÃ©matiques</h1>
    <p class="subtitle" id="subtitle">DÃ©couvre tes ressources en 3 Ã©tapes</p>
   </header>
   <main class="content-card">
    <div id="contentArea"></div>
   </main>
  </div>
  <div class="bottom-capsules">
   <div class="capsule"></div>
   <div class="capsule"></div>
   <div class="capsule"></div>
   <div class="capsule"></div>
   <div class="capsule"></div>
  </div>
  <script>
    const defaultConfig = {
      main_title: "Mini Parcours ThÃ©matiques",
      subtitle: "DÃ©couvre tes ressources en 3 Ã©tapes",
      start_button: "Commencer",
      next_button: "Suivant",
      back_button: "Retour",
      finish_button: "Terminer",
      background_color: "#ffffff",
      accent_red: "#FF1744",
      accent_yellow: "#FFD600",
      accent_turquoise: "#00BFA5",
      text_color: "#424242",
      font_family: "Poppins",
      font_size: 16
    };

    const domains = [
      {
        id: 'emploi',
        emoji: 'ğŸ’¼',
        title: 'EMPLOI',
        subtitle: 'Chercher et travailler',
        className: 'emploi',
        activities: [
          {
            id: 'emploi_1',
            title: 'Mes compÃ©tences cachÃ©es',
            objective: 'Tu en as plus que tu crois',
            type: 'flip_cards',
            cards: [
              { recto: 'ğŸ›ï¸ Ranger ma chambre', verso: 'Organisation', skill: 'organisation' },
              { recto: 'ğŸ¤ Aider quelqu\'un', verso: 'Patience', skill: 'patience' },
              { recto: 'âš½ Jouer en Ã©quipe', verso: 'CoopÃ©ration', skill: 'coopÃ©ration' },
              { recto: 'ğŸ‘¶ M\'occuper d\'un enfant', verso: 'ResponsabilitÃ©', skill: 'responsabilitÃ©' },
              { recto: 'ğŸ³ Faire Ã  manger', verso: 'Autonomie', skill: 'autonomie' },
              { recto: 'ğŸ“š Devoirs faits', verso: 'PersÃ©vÃ©rance', skill: 'persÃ©vÃ©rance' },
              { recto: 'ğŸšŒ Faire un trajet seul', verso: 'DÃ©brouillardise', skill: 'dÃ©brouillardise' },
              { recto: 'ğŸ”§ DÃ©panner un ami', verso: 'Entraide', skill: 'entraide' },
              { recto: 'ğŸ˜° GÃ©rer un stress', verso: 'Gestion Ã©motions', skill: 'gestion' },
              { recto: 'ğŸ”¨ RÃ©parer un objet', verso: 'Logique', skill: 'logique' },
              { recto: 'ğŸ“… Organiser un RDV', verso: 'Planification', skill: 'planification' },
              { recto: 'ğŸ® Apprendre un tuto', verso: 'Adaptation', skill: 'adaptation' }
            ]
          },
          {
            id: 'emploi_2',
            title: 'Au travail : tu rÃ©agirais comment ?',
            objective: 'Comprendre les codes de l\'emploi',
            type: 'scenarios_abc',
            scenarios: [
              {
                situation: 'Tu arrives et ton tuteur te dit que la tÃ¢che a changÃ©. Tu fais quoi ?',
                options: [
                  { label: 'A â€“ Je me braque', feedback: 'Se braquer peut bloquer la relation. Essaie d\'Ã©couter d\'abord.' },
                  { label: 'B â€“ Je demande pourquoi', feedback: 'Demander, c\'est pro. Tu montres ton intÃ©rÃªt.' },
                  { label: 'C â€“ Je m\'adapte', feedback: 'T\'adapter = compÃ©tence clÃ© en emploi !' }
                ]
              },
              {
                situation: 'On te fait une remarque. Tu fais quoi ?',
                options: [
                  { label: 'A â€“ Je pars', feedback: 'Partir bloque le maintien en emploi. La remarque peut Ãªtre constructive.' },
                  { label: 'B â€“ Je stresse', feedback: 'C\'est normal de stresser. Respire et demande des prÃ©cisions.' },
                  { label: 'C â€“ Je demande d\'expliquer', feedback: 'Parfait ! Demander montre ta volontÃ© de progresser.' }
                ]
              },
              {
                situation: 'Tu ne comprends pas une consigne. Tu fais quoi ?',
                options: [
                  { label: 'A â€“ Je fais semblant', feedback: 'Faire semblant peut mener Ã  des erreurs. Ose demander !' },
                  { label: 'B â€“ Je laisse tomber', feedback: 'Laisser tomber empÃªche d\'apprendre. Demande de l\'aide.' },
                  { label: 'C â€“ Je demande', feedback: 'Excellent ! Demander Ã©vite les erreurs et montre ton sÃ©rieux.' }
                ]
              }
            ]
          },
          {
            id: 'emploi_3',
            title: 'Quel job je peux supporter (pour de vrai) ?',
            objective: 'Se projeter dans un environnement rÃ©aliste',
            type: 'sliders',
            intro: 'Trouver un job, c\'est aussi savoir ce que TU peux supporter.',
            sliders: [
              { label: 'â° Horaires', min: 'TÃ´t le matin', max: 'Tard le soir', icon: 'ï¿½ï¿½ï¿½' },
              { label: 'ğŸ”Š Ambiance', min: 'Calme', max: 'Bruyant', icon: 'ğŸ”Š' },
              { label: 'ğŸª‘ Position', min: 'Assis', max: 'Debout', icon: 'ğŸª‘' },
              { label: 'ğŸ‘¥ Contact', min: 'Seul', max: 'En Ã©quipe', icon: 'ï¿½ï¿½' },
              { label: 'ğŸ“‹ TÃ¢ches', min: 'Simples', max: 'VariÃ©es', icon: 'ğŸ“‹' }
            ]
          }
        ]
      },
      {
        id: 'formation',
        emoji: 'ğŸ“š',
        title: 'FORMATION',
        subtitle: 'Apprendre et tenir le rythme',
        className: 'formation',
        activities: [
          {
            id: 'formation_1',
            title: 'Comment j\'apprends le mieux ?',
            objective: 'Tu n\'es pas nul : tu as ta maniÃ¨re d\'apprendre',
            type: 'learning_styles',
            intro: 'Pour tenir une formation, connaÃ®tre ta maniÃ¨re d\'apprendre est essentiel.',
            maxSelection: 2,
            options: [
              { icon: 'ğŸ‘€', label: 'En regardant', description: 'Tutos, photos, schÃ©mas' },
              { icon: 'âœ‹', label: 'En faisant', description: 'Manipuler, tester' },
              { icon: 'ğŸ‘‚', label: 'En Ã©coutant', description: 'Explications, audio' },
              { icon: 'â“', label: 'En demandant', description: 'Poser questions, reformuler' },
              { icon: 'ğŸ”', label: 'En rÃ©pÃ©tant', description: 'Faire plusieurs fois' },
              { icon: 'ğŸ‘¥', label: 'En groupe', description: 'Apprendre avec d\'autres' }
            ],
            conclusion: 'ConnaÃ®tre ta maniÃ¨re d\'apprendre t\'aidera Ã  tenir en formation et Ã  mieux comprendre.'
          },
          {
            id: 'formation_2',
            title: 'Mon rythme possible',
            objective: 'Identifier sa capacitÃ© rÃ©elle ï¿½ï¿½ tenir',
            type: 'rhythm_sliders',
            intro: 'Pour tenir une formation, connaÃ®tre ton rythme est essentiel.',
            sliders: [
              { label: 'â±ï¸ DurÃ©e d\'attention', min: '15 min', max: '2h' },
              { label: 'ğŸŒ… Moment prÃ©fÃ©rÃ©', min: 'Matin', max: 'AprÃ¨s-midi' },
              { label: 'ï¿½ï¿½ Rythme', min: 'Lent', max: 'Rapide' },
              { label: 'ğŸ’ª Endurance', min: 'Je fatigue vite', max: 'Je tiens longtemps' },
              { label: 'ğŸ“… RÃ©gularitÃ©', min: 'IrrÃ©gulier', max: 'Je peux tenir 3 jours/semaine' }
            ],
            conclusion: 'ConnaÃ®tre ton rythme t\'aide Ã  choisir une formation que tu peux tenir.'
          },
          {
            id: 'formation_3',
            title: 'L\'outil qui peut m\'aider Ã  suivre',
            objective: '1 stratÃ©gie simple pour Ã©viter l\'oubli',
            type: 'tool_selection',
            intro: 'Pour suivre une formation, un outil simple peut changer beaucoup de choses.',
            options: [
              { icon: 'ğŸ“±', label: 'Rappel tÃ©lÃ©phone', description: 'Alarmes et notifications' },
              { icon: 'ğŸ““', label: 'Agenda papier', description: 'Noter jour par jour' },
              { icon: 'âœï¸', label: 'Carnet de notes', description: 'Ã‰crire les consignes' },
              { icon: 'ğŸ“¸', label: 'Photo des consignes', description: 'Prendre en photo le tableau' },
              { icon: 'ğŸ“‹', label: 'Planning hebdo', description: 'Vue de la semaine' },
              { icon: 'ğŸ“²', label: 'Application notes/tÃ¢che', description: 'To-do list numÃ©rique' }
            ],
            conclusion: 'Un outil simple = moins d\'oubli, moins de stress, plus de rÃ©ussite en formation.'
          }
        ]
      },
      {
        id: 'numerique',
        emoji: 'ğŸ’»',
        title: 'NUMÃ‰RIQUE',
        subtitle: 'CompÃ©tences digitales essentielles',
        className: 'numerique',
        activities: [
          {
            id: 'numerique_1',
            title: 'Teste tes compÃ©tences numÃ©riques avec le parcours PIX',
            objective: 'Ã‰value et certifie tes compÃ©tences numÃ©riques',
            type: 'external_link',
            url: 'https://app.pix.fr/campagnes/NGWQSX661',
            buttonText: 'AccÃ©der au parcours PIX',
            description: 'PIX est un service public en ligne pour Ã©valuer, dÃ©velopper et certifier tes compÃ©tences numÃ©riques. C\'est gratuit et reconnu par l\'Ã‰tat !'
          }
        ]
      },
      {
        id: 'orientation',
        emoji: 'ğŸ§­',
        title: 'ORIENTATION',
        subtitle: 'Projet et idÃ©es pour la suite',
        className: 'orientation',
        activities: [
          {
            id: 'orientation_1',
            title: 'J\'aime / j\'aime pas : ce que je ressens vraiment',
            objective: 'Sortir du "je ne sais rien", faire ressortir des prÃ©fÃ©rences concrÃ¨tes',
            type: 'drag_sort_categories',
            intro: 'Clique sur chaque carte pour la mettre dans "J\'aime" ou "J\'aime pas"',
            categories: {
              people: { name: 'People', items: ['ğŸ‘¥ Aider', 'ğŸ’¬ Parler', 'ğŸ¤ Accueillir', 'ğŸ‘‚ Ã‰couter'] },
              nature: { name: 'Nature/Manuel', items: ['ğŸŒ± Plantes', 'ï¿½ï¿½ Outils', 'ğŸ”¨ Bricolage', 'ğŸŒ³ ExtÃ©rieur'] },
              creative: { name: 'CrÃ©atif', items: ['ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ Dessin', 'ğŸ“¸ Photo', 'ğŸµ Musique', 'ğŸ³ Cuisine'] },
              technical: { name: 'Technique/NumÃ©rique', items: ['ğŸ’» Ordinateur', 'ğŸ¬ Montage', 'ğŸ”Œ CÃ¢bles', 'ğŸ“‹ Organisation'] }
            },
            conclusion: 'Ce que tu aimes te donne des pistes pour ton futur projet ou ta prochaine immersion.'
          },
          {
            id: 'orientation_2',
            title: 'Ce que j\'ai fait â†’ Ce que Ã§a peut donner',
            objective: 'Relier expÃ©riences, loisirs ou galÃ¨res Ã  des compÃ©tences utiles',
            type: 'flip_experiences',
            intro: 'Tu as dÃ©jÃ  fait plein de choses. Elles peuvent t\'ouvrir des portes.',
            cards: [
              { recto: 'ğŸ® Jouer Ã  des jeux vidÃ©o', verso: 'RÃ©activitÃ©', skill: 'rÃ©activitÃ©' },
              { recto: 'ğŸ‘¶ S\'occuper d\'un petit frÃ¨re/sÅ“ur', verso: 'Patience', skill: 'patience' },
              { recto: 'âš½ Faire du sport', verso: 'Motivation', skill: 'motivation' },
              { recto: 'ğŸ“± Utiliser TikTok/Insta', verso: 'CrÃ©ativitÃ©', skill: 'crÃ©ativitÃ©' },
              { recto: 'ğŸ¤ Aider un ami', verso: 'Empathie', skill: 'empathie' },
              { recto: 'ğŸ³ Cuisiner', verso: 'Organisation', skill: 'organisation' },
              { recto: 'ğŸ“¦ Participer ï¿½ï¿½ un dÃ©mÃ©nagement', verso: 'Logistique', skill: 'logistique' },
              { recto: 'ğŸ’¼ Faire un stage', verso: 'AdaptabilitÃ©', skill: 'adaptabilitÃ©' },
              { recto: 'ğŸ‘• Vendre sur Vinted', verso: 'Communication', skill: 'communication' },
              { recto: 'ğŸ”§ RÃ©parer un truc', verso: 'DÃ©brouillardise', skill: 'dÃ©brouillardise' },
              { recto: 'ğŸ’¬ Tenir un compte Snap', verso: 'NumÃ©rique', skill: 'numÃ©rique' },
              { recto: 'âœˆï¸ Voyager seul', verso: 'Autonomie', skill: 'autonomie' },
              { recto: 'ğŸš¶ Marcher beaucoup', verso: 'MobilitÃ©', skill: 'mobilitÃ©' },
              { recto: 'ğŸ“… GÃ©rer un rendez-vous', verso: 'Planification', skill: 'planification' }
            ],
            conclusion: 'Voir les liens entre ce que tu fais et des mÃ©tiers t\'aidera Ã  construire ton projet.'
          },
          {
            id: 'orientation_3',
            title: 'Ma direction provisoire',
            objective: 'Fixer un cap lÃ©ger, sans pression',
            type: 'direction_bubbles',
            intro: 'Tu n\'as pas besoin d\'un mÃ©tier prÃ©cis. Une DIRECTION suffit pour avancer.',
            options: [
              { icon: 'ğŸ”¨', label: 'Manuel', description: 'Outils, bricolage', color: '#FF4F73' },
              { icon: 'ğŸ‘¥', label: 'Relationnel', description: 'Aide, accueil, santÃ©', color: '#46D9D2' },
              { icon: 'ğŸ’»', label: 'Technique', description: 'Informatique, machines', color: '#FFD75B' },
              { icon: 'ğŸ¨', label: 'CrÃ©atif', description: 'Arts, images, cuisine', color: '#FF4F73' },
              { icon: 'ğŸŒ³', label: 'ExtÃ©rieur/Nature', description: 'Sport, environnement', color: '#46D9D2' },
              { icon: 'ğŸ“‹', label: 'Organisation/Service', description: 'Logistique, vente', color: '#FFD75B' }
            ],
            conclusion: 'En atelier, on va transformer cette direction en pistes concrÃ¨tes et testables.'
          }
        ]
      },
      {
        id: 'etranger',
        emoji: 'âœˆï¸',
        title: 'PARTIR Ã€ L\'Ã‰TRANGER',
        subtitle: 'MobilitÃ© internationale',
        className: 'mobilite',
        activities: [
          {
            id: 'etranger_1',
            title: 'Auto-positionnement mobilitÃ© internationale',
            objective: 'Ã‰value ton projet de mobilitÃ© Ã  l\'Ã©tranger',
            type: 'external_link',
            url: 'https://mlpb-tools.github.io/AutopoMobinter/',
            buttonText: 'AccÃ©der Ã  l\'auto-positionnement',
            description: 'Un outil pour t\'aider Ã  clarifier ton projet d\'expÃ©rience Ã  l\'Ã©tranger et identifier tes besoins'
          }
        ]
      },
      {
        id: 'mobilite',
        emoji: 'ğŸš—',
        title: 'MOBILITÃ‰',
        subtitle: 'Se dÃ©placer pour avancer',
        className: 'mobilite',
        activities: [
          {
            id: 'mobilite_1',
            title: 'Diagnostic MobilitÃ© 360Â°',
            objective: 'Ã‰value ta situation de mobilitÃ© et trouve des solutions',
            type: 'external_link',
            url: 'https://mlpb-tools.github.io/diagmob360/',
            buttonText: 'AccÃ©der au diagnostic mobilitÃ©',
            description: 'Un outil pour identifier tes besoins et solutions de mobilitÃ© : transports, permis, vÃ©lo, covoiturage...'
          }
        ]
      },
      {
        id: 'sante',
        emoji: 'ğŸ’š',
        title: 'SANTÃ‰',
        subtitle: 'Bien-Ãªtre physique & mental',
        className: 'sante',
        activities: [
          {
            id: 'sante_1',
            title: 'Mes signaux d\'alerte',
            objective: 'Comment je sais que Ã§a ne va plus',
            type: 'signal_selector',
            intro: 'Chaque personne a des signaux qui montrent que Ã§a dÃ©borde. DÃ©couvre les tiens.',
            maxSelection: 3,
            signals: [
              { icon: 'ğŸ˜´', label: 'Fatigue intense', description: 'Je suis Ã©puisÃ©(e)' },
              { icon: 'ğŸ¤•', label: 'Maux de ventre / tÃªte', description: 'Douleurs physiques' },
              { icon: 'ğŸŒ™', label: 'Sommeil cassÃ©', description: 'Je dors mal' },
              { icon: 'ğŸ˜¤', label: 'IrritabilitÃ©', description: 'Tout m\'Ã©nerve' },
              { icon: 'ğŸ’”', label: 'Stress dans la poitrine', description: 'Oppression' },
              { icon: 'ğŸ›Œ', label: 'DifficultÃ© Ã  me lever', description: 'Pas d\'Ã©nergie' },
              { icon: 'ğŸšª', label: 'Isolement / envie de fuir', description: 'Je m\'Ã©loigne' },
              { icon: 'ğŸ˜¡', label: 'ColÃ¨re rapide', description: 'J\'explose vite' },
              { icon: 'ğŸ§Š', label: 'Blocage / freeze', description: 'Je ne peux plus bouger' },
              { icon: 'ğŸ˜¢', label: 'Pleurs frÃ©quents', description: 'Ã‰motions dÃ©bordantes' },
              { icon: 'ğŸŒ€', label: 'DifficultÃ© Ã  me concentrer', description: 'TÃªte dans le brouillard' },
              { icon: 'â¬‡ï¸', label: 'Perte de motivation totale', description: 'Plus rien ne me parle' }
            ],
            conclusion: 'Ces signaux te prÃ©viennent AVANT que Ã§a dÃ©borde.',
            insertion_message: 'RepÃ©rer tes signaux te permettra d\'Ã©viter les ruptures de parcours (emploi, formation, rdv).'
          },
          {
            id: 'sante_2',
            title: 'Ce qui m\'apaise',
            objective: 'Identifier ce qui fonctionne vraiment pour moi',
            type: 'apaisement_selector',
            intro: 'Chaque personne a des choses qui l\'apaisent. DÃ©couvre les tiennes.',
            strategies: [
              { icon: 'ğŸš¶', label: 'Marcher 10 minutes', description: 'Bouger un peu' },
              { icon: 'ğŸµ', label: 'Musique favorite', description: 'Sons qui font du bien' },
              { icon: 'ğŸ¤«', label: 'Temps calme seul', description: 'M\'isoler positivement' },
              { icon: 'ğŸ’¬', label: 'Parler Ã  quelqu\'un', description: 'Dire ce que je ressens' },
              { icon: 'ğŸŒ³', label: 'Aller dehors', description: 'Changer d\'air' },
              { icon: 'ğŸ«', label: 'Respiration courte', description: '3 grandes respirations' },
              { icon: 'ğŸ’§', label: 'Boire un verre d\'eau', description: 'RÃ©hydrater' },
              { icon: 'âœ¨', label: 'Ranger un peu', description: 'Mettre de l\'ordre' },
              { icon: 'ğŸ®', label: 'DÃ©tourner l\'attention', description: 'Jeu, vidÃ©o courte' },
              { icon: 'ğŸ¤¸', label: 'M\'Ã©tirer', description: 'RelÃ¢cher les tensions' },
              { icon: 'ğŸš¿', label: 'Me doucher', description: 'Sensation apaisante' },
              { icon: 'ğŸ”‡', label: 'Sortir du bruit', description: 'Trouver le calme' }
            ],
            conclusion: 'Avoir 1 ou 2 faÃ§ons de te calmer t\'aide Ã  rester stable dans un travail ou une formation.'
          },
          {
            id: 'sante_3',
            title: 'Ã€ qui je peux demander de l\'aide ?',
            objective: 'Identifier un adulte ressource fiable',
            type: 'help_resources',
            intro: 'Personne ne doit gÃ©rer seul quand Ã§a dÃ©borde. Qui peut t\'aider ?',
            maxSelection: 3,
            resources: [
              { icon: 'ğŸ‘¥', label: 'Un ami', description: 'Quelqu\'un de mon Ã¢ge' },
              { icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', label: 'Un membre de ma famille', description: 'Parent, frÃ¨re, sÅ“ur' },
              { icon: 'ğŸ‘”', label: 'Un conseiller ML', description: 'Mission Locale' },
              { icon: 'ğŸ©º', label: 'Un Ã©duc / psy / infirmier', description: 'Pro de santÃ©' },
              { icon: 'ğŸ“š', label: 'Un prof / formateur', description: 'RÃ©fÃ©rent formation' },
              { icon: 'ğŸ’¼', label: 'Un collÃ¨gue / tuteur', description: 'Au travail' },
              { icon: 'â¤ï¸', label: 'Une personne de confiance', description: 'Quelqu\'un qui me comprend' },
              { icon: 'ğŸ¥', label: 'Un lieu ressource', description: 'Maison SantÃ©, Point Accueil' }
            ],
            question: 'La personne Ã  qui je peux parler en premier :',
            conclusion: 'Avoir une personne ressource, c\'est Ã©viter que tout s\'arrÃªte d\'un coup (formation, emploi, projet).'
          }
        ]
      },
      {
        id: 'logement',
        emoji: 'ğŸ ',
        title: 'LOGEMENT',
        subtitle: 'Lieu de vie & sÃ©curitÃ© personnelle',
        className: 'logement',
        activities: [
          {
            id: 'logement_1',
            title: 'OÃ¹ j\'habite vraiment ?',
            objective: 'Sans jugement',
            type: 'housing_situation',
            intro: 'Ta situation, quelle qu\'elle soit, mÃ©rite d\'Ãªtre entendue sans jugement.',
            situations: [
              { icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', label: 'Chez mes parents', description: 'Avec ma famille' },
              { icon: 'ğŸ¤', label: 'HÃ©bergÃ© chez un ami', description: 'Temporairement' },
              { icon: 'ğŸ‘ª', label: 'Chez un membre de ma famille', description: 'Autre que parents' },
              { icon: 'ğŸ’‘', label: 'En couple', description: 'Chez mon/ma partenaire' },
              { icon: 'ğŸ¢', label: 'En chambre / foyer / rÃ©sidence', description: 'Logement accompagnÃ©' },
              { icon: 'ğŸ”„', label: 'Alternance de lieux', description: 'Je bouge souvent' },
              { icon: 'ğŸ›‹ï¸', label: 'HÃ©bergement prÃ©caire', description: 'CanapÃ©, voiture...' },
              { icon: 'ğŸ¤', label: 'Situation instable / je prÃ©fÃ¨re ne pas dire', description: 'C\'est compliquÃ©' }
            ],
            question: 'Ma situation aujourd\'hui, c\'est surtout :',
            conclusion: 'Dire ta situation permet d\'avancer vers un lieu de vie plus stable et adaptÃ© Ã  tes besoins.',
            insertion_message: 'Dire ta situation permet d\'avancer vers un lieu de vie plus stable et adaptÃ© Ã  tes besoins.'
          },
          {
            id: 'logement_2',
            title: 'Ce qui me fait me sentir en sÃ©curitÃ©',
            objective: 'Identifier mes besoins essentiels',
            type: 'security_needs',
            intro: 'Un logement, ce n\'est pas juste un toit. C\'est ce qui TE fait te sentir en sÃ©curitÃ©.',
            needs: [
              { icon: 'ğŸ”‡', label: 'Calme', description: 'Pas de bruit constant' },
              { icon: 'ğŸšª', label: 'IntimitÃ©', description: 'Mon espace Ã  moi' },
              { icon: 'ğŸ“¦', label: 'Espace pour moi', description: 'De la place' },
              { icon: 'ğŸ’¡', label: 'LumiÃ¨re', description: 'Espace lumineux' },
              { icon: 'âœ¨', label: 'PropretÃ©', description: 'Lieu propre' },
              { icon: 'ğŸ˜Œ', label: 'Pas de tension', description: 'Ambiance sereine' },
              { icon: 'ğŸ›¡ï¸', label: 'Pas de violence', description: 'SÃ©curitÃ© physique' },
              { icon: 'ğŸ“‹', label: 'RÃ¨gles claires', description: 'Je sais Ã  quoi m\'attendre' },
              { icon: 'âš“', label: 'StabilitÃ©', description: 'DurÃ©e prÃ©visible' },
              { icon: 'ğŸ‘¥', label: 'Pouvoir inviter quelqu\'un', description: 'Recevoir des amis' },
              { icon: 'ğŸ§˜', label: 'Pouvoir m\'isoler', description: 'Me retirer quand j\'en ai besoin' },
              { icon: 'ğŸ’', label: 'Avoir mes affaires Ã  moi', description: 'Mes objets personnels' }
            ],
            question: 'Pour moi, la sÃ©curitÃ©, c\'est surtout :',
            conclusion: 'ConnaÃ®tre ce dont tu as besoin t\'aide Ã  trouver un logement qui te respecte et te correspond.'
          },
          {
            id: 'logement_3',
            title: 'Un premier pas logement',
            objective: 'DÃ©bloquer le passage Ã  l\'action',
            type: 'first_step_housing',
            intro: 'Tu n\'as pas besoin de tout rÃ©gler. Un petit pas suffit pour avancer.',
            steps: [
              { icon: 'ğŸ’¬', label: 'Demander une info logement', description: 'Poser une question simple' },
              { icon: 'ğŸ“', label: 'Identifier un lieu ressource', description: 'CCAS, foyer, RÃ©sidence Jeunes' },
              { icon: 'ğŸ—£ï¸', label: 'Parler de ma situation Ã  un conseiller ML', description: 'Dire oÃ¹ j\'en suis' },
              { icon: 'ğŸ’°', label: 'Voir les aides possibles', description: 'APL, FSL, garanties' },
              { icon: 'ï¿½ï¿½', label: 'Regarder une annonce pour comprendre', description: 'Comment Ã§a marche' },
              { icon: 'â“', label: 'PrÃ©parer une question logement', description: 'Clarifier ce que je ne comprends pas' }
            ],
            question: 'Le petit pas que je choisis :',
            conclusion: 'Un petit pas peut Ã©viter une rupture, te protÃ©ger et t\'aider Ã  avancer vers un logement plus stable.'
          }
        ]
      },
      {
        id: 'citoyennete',
        emoji: 'ğŸ¤',
        title: 'CITOYENNETÃ‰',
        subtitle: 'Droits & participation',
        className: 'citoyennete',
        activities: [
          {
            id: 'citoyennete_1',
            title: 'Ma place en groupe',
            objective: 'Sans pression',
            type: 'group_position_sliders',
            intro: 'Aider Ã  identifier comment tu vis les interactions sans te dÃ©valoriser.',
            mainSlider: { 
              label: 'ï¿½ï¿½ En groupe, je...', 
              min: 'J\'ose pas trop parler', 
              max: 'Je parle facilement',
              emojis: ['ğŸ¤', 'ğŸ˜¶', 'ğŸ¤”', 'ğŸ’¬', 'ğŸ—£ï¸']
            },
            additionalSliders: [
              { label: 'ğŸ‘¥ Je prÃ©fÃ¨re Ãªtre...', min: 'En petit groupe', max: 'En grand groupe' },
              { label: 'ğŸ­ Je suis Ã  l\'aise avec...', min: 'Ã‰couter', max: 'Parler' }
            ],
            question: 'En groupe, j\'ai surtout besoin de :',
            conclusion: 'ConnaÃ®tre ta place en groupe facilite les ateliers, les formations et les jobs d\'Ã©quipe.'
          },
          {
            id: 'citoyennete_2',
            title: 'GÃ©rer un dÃ©saccord simple',
            objective: 'RÃ©gulation - Ã©viter fuite ou explosion',
            type: 'disagreement_scenarios',
            intro: 'Un dÃ©saccord, ce n\'est pas un conflit. C\'est normal. Tu ferais quoi ?',
            scenarios: [
              {
                situation: 'Quelqu\'un te coupe la parole.',
                options: [
                  { label: 'A â€“ Je me tais et je laisse tomber', feedback: 'Se taire = tu ne te fais pas entendre. Tu as le droit d\'exprimer ton point de vue.' },
                  { label: 'B â€“ Je m\'Ã©nerve et je hausse le ton', feedback: 'S\'Ã©nerver = Ã§a complique souvent la situation. Respire et reformule calmement.' },
                  { label: 'C â€“ Je dis calmement "Excuse-moi, je n\'avais pas fini"', feedback: 'Dire calmement = tu te respectes et tu poses tes limites. C\'est assertif et efficace !' }
                ]
              },
              {
                situation: 'Un proche te demande un service que tu ne peux pas faire.',
                options: [
                  { label: 'A â€“ J\'accepte mÃªme si je ne peux pas', feedback: 'Accepter par obligation crÃ©e du stress et de la frustration. Tu as le droit de dire non.' },
                  { label: 'B â€“ Je refuse sÃ¨chement sans expliquer', feedback: 'Refuser brutalement peut blesser. Explique ton refus avec respect pour prÃ©server la relation.' },
                  { label: 'C â€“ Je dis "Je ne peux pas cette fois, dÃ©solÃ©(e)"', feedback: 'Parfait ! Tu poses une limite claire tout en restant respectueux. C\'est de l\'assertivitÃ©.' }
                ]
              },
              {
                situation: 'Un camarade se trompe Ã  propos de toi.',
                options: [
                  { label: 'A â€“ Je laisse faire, c\'est pas grave', feedback: 'Laisser passer peut crÃ©er des malentendus durables. Tu peux rectifier gentiment.' },
                  { label: 'B â€“ Je rÃ©agis fort pour me dÃ©fendre', feedback: 'RÃ©agir fort peut aggraver les tensions. Une correction calme est plus efficace.' },
                  { label: 'C â€“ Je dis "En fait, c\'est pas Ã§a, je t\'explique"', feedback: 'Excellent ! Tu corriges l\'erreur sans agressivitÃ©. C\'est une communication saine.' }
                ]
              }
            ],
            conclusion: 'Savoir gÃ©rer un dÃ©saccord aide dans les stages, les formations et les emplois.'
          },
          {
            id: 'citoyennete_3',
            title: 'Un droit que j\'ai peut-Ãªtre',
            objective: 'Empowerment - dÃ©velopper la lÃ©gitimitÃ©',
            type: 'rights_flip_cards',
            intro: 'Tu as des droits, mÃªme si personne ne te l\'a expliquÃ© clairement.',
            cards: [
              { 
                icon: 'ğŸ¥', 
                recto: 'Droit Ã  la santÃ©', 
                verso: 'AccÃ¨s psy, mÃ©decin, soin sans jugement. La santÃ© mentale et physique est un droit, pas un luxe.',
                right: 'santÃ©'
              },
              { 
                icon: 'ğŸ ', 
                recto: 'Droit au logement', 
                verso: 'Aides, accompagnement, prioritÃ© jeune. Tu as droit Ã  un logement digne et stable.',
                right: 'logement'
              },
              { 
                icon: 'ğŸ’¼', 
                recto: 'Droit au travail', 
                verso: 'Contrat, horaires, respect. Tout travail mÃ©rite un contrat et des conditions dignes.',
                right: 'travail'
              },
              { 
                icon: 'ï¿½ï¿½ï¿½', 
                recto: 'Droit Ã  la formation', 
                verso: 'RÃ©munÃ©ration, protection. Se former est un droit, avec accompagnement et soutien financier.',
                right: 'formation'
              },
              { 
                icon: 'âš–ï¸', 
                recto: 'Droit Ã  la non-discrimination', 
                verso: 'Recours, accompagnement. Personne n\'a le droit de te discriminer (origine, genre, handicap, etc.).',
                right: 'non-discrimination'
              },
              { 
                icon: 'ï¿½ï¿½', 
                recto: 'Droit au revenu', 
                verso: 'Aides CAF, RSA jeune sous conditions. Tu peux avoir droit Ã  des aides pour vivre dignement.',
                right: 'revenu'
              },
              { 
                icon: 'ğŸ›¡ï¸', 
                recto: 'Droit Ã  la protection', 
                verso: 'Violence / harcÃ¨lement : lieux ressource. Tu as droit Ã  la sÃ©curitÃ© et Ã  l\'aide en cas de danger.',
                right: 'protection'
              },
              { 
                icon: 'ğŸ“¢', 
                recto: 'Droit Ã  l\'information', 
                verso: 'ML, structures jeunesse. Tu as le droit de savoir ce qui existe pour toi et d\'Ãªtre accompagnÃ©.',
                right: 'information'
              }
            ],
            question: 'Quel droit te semble important pour toi en ce moment ?',
            actionQuestion: 'Je pourrais demander plus d\'infos sur :',
            conclusion: 'ConnaÃ®tre tes droits t\'aide ï¿½ï¿½ te protÃ©ger, avancer et Ã©viter les ruptures.'
          }
        ]
      },
      {
        id: 'loisirs',
        emoji: 'ğŸ¨',
        title: 'LOISIRS',
        subtitle: 'ActivitÃ©s ressources & Ã©nergie',
        className: 'loisirs',
        activities: [
          {
            id: 'loisirs_1',
            title: 'Ce qui me fait du bien',
            objective: 'MÃªme si c\'est simple',
            type: 'wellbeing_moodboard',
            intro: 'Tu ne fais pas "rien". Tu fais plein de choses qui te font du bien.',
            maxSelection: 6,
            activities: [
              { icon: 'ğŸµ', label: 'Musique', description: 'Ã‰couter, crÃ©er' },
              { icon: 'ğŸ¨', label: 'Dessin', description: 'Dessiner, colorier' },
              { icon: 'ğŸ³', label: 'Cuisine', description: 'PrÃ©parer Ã  manger' },
              { icon: 'ğŸ®', label: 'Jeu vidÃ©o', description: 'Jouer solo ou en ligne' },
              { icon: 'ğŸŒ²', label: 'Marche / forÃªt', description: 'Balade nature' },
              { icon: 'âš½', label: 'Sport', description: 'Bouger, se dÃ©penser' },
              { icon: 'ğŸ’ƒ', label: 'Danse', description: 'Danser seul ou en groupe' },
              { icon: 'ğŸ“º', label: 'SÃ©ries', description: 'Regarder des sÃ©ries' },
              { icon: 'ğŸ“¸', label: 'Photo', description: 'Prendre des photos' },
              { icon: 'ğŸ›¹', label: 'Skate', description: 'Skate, trottinette' },
              { icon: 'ğŸ•', label: 'Animaux', description: 'M\'occuper d\'animaux' },
              { icon: 'ï¿½ï¿½', label: 'Nature', description: 'ÃŠtre dehors' },
              { icon: 'ğŸ“š', label: 'Lecture', description: 'Lire, BD, mangas' },
              { icon: 'ğŸ˜´', label: 'Dormir', description: 'Me reposer' },
              { icon: 'ğŸ§˜', label: 'MÃ©ditation simple', description: 'Respirer, me poser' },
              { icon: 'ğŸ¤«', label: 'Temps seul', description: 'Moment Ã  moi' },
              { icon: 'â˜•', label: 'CafÃ© avec quelqu\'un', description: 'Voir des gens' },
              { icon: 'ğŸ”§', label: 'Bricolage', description: 'RÃ©parer, crÃ©er' },
              { icon: 'ğŸ§µ', label: 'Couture / crÃ©a', description: 'ActivitÃ© manuelle' },
              { icon: 'ï¿½ï¿½', label: 'Jouer d\'un instrument', description: 'Musique active' }
            ],
            question: 'Ce qui m\'aide le plus quand je suis mal :',
            conclusion: 'ConnaÃ®tre ce qui te fait du bien t\'aide Ã  garder de l\'Ã©nergie pour ton projet.'
          },
          {
            id: 'loisirs_2',
            title: 'Les compÃ©tences derriÃ¨re mes loisirs',
            objective: 'Tu vas le voir',
            type: 'hobby_skills_flip',
            intro: 'Tes loisirs dÃ©veloppent des compÃ©tences. Tu vas le voir.',
            cards: [
              { recto: 'ğŸ® Jeu vidÃ©o', verso: 'Prise de dÃ©cision / Patience', skill: 'dÃ©cision' },
              { recto: 'âš½ Sport', verso: 'RÃ©gularitÃ© / Effort', skill: 'rÃ©gularitÃ©' },
              { recto: 'ğŸ³ Cuisine', verso: 'Organisation', skill: 'organisation' },
              { recto: 'ğŸ’ƒ Danse', verso: 'Coordination / Confiance', skill: 'coordination' },
              { recto: 'ğŸ¨ Dessin', verso: 'CrÃ©ativitÃ© / Concentration', skill: 'crÃ©ativitÃ©' },
              { recto: 'ğŸ“¸ Photo', verso: 'Regard / PrÃ©cision', skill: 'regard' },
              { recto: 'ğŸŒ² Marche', verso: 'Gestion du stress', skill: 'stress' },
              { recto: 'ğŸ“º SÃ©ries', verso: 'Imagination / Analyse', skill: 'imagination' },
              { recto: 'ğŸ• Animaux', verso: 'ResponsabilitÃ©', skill: 'responsabilitÃ©' },
              { recto: 'ï¿½ï¿½ï¿½ï¿½ Bricolage', verso: 'Logique / Autonomie', skill: 'logique' },
              { recto: 'ğŸ§µ Couture / crÃ©a', verso: 'PrÃ©cision / PersÃ©vÃ©rance', skill: 'prÃ©cision' },
              { recto: 'ğŸ¸ Musique', verso: 'RÃ©gularitÃ© / Expression', skill: 'expression' }
            ],
            question: 'Quelle compÃ©tence te surprend ? Pourquoi ?',
            conclusion: 'Tes loisirs peuvent devenir des arguments pour un CV, un entretien, ou une formation.'
          },
          {
            id: 'loisirs_3',
            title: 'Une activitÃ© accessible pour moi',
            objective: 'Faisable et gratuite ou peu coÃ»teuse',
            type: 'accessible_activity',
            intro: 'Faire une activitÃ©, Ã§a ne doit pas coÃ»ter cher. Tu choisis celle qui est possible pour toi.',
            activities: [
              { icon: 'ğŸ“š', label: 'BibliothÃ¨que gratuite', description: 'Livres, BD, internet gratuit' },
              { icon: 'ğŸƒ', label: 'Sport extÃ©rieur', description: 'Parc, plage, course' },
              { icon: 'ğŸ¯', label: 'Atelier gratuit Mission Locale', description: 'Ateliers et animations' },
              { icon: 'ï¿½ï¿½', label: 'Balade nature', description: 'Sentiers, forÃªts' },
              { icon: 'ğŸ›ï¸', label: 'Visite culturelle gratuite', description: 'MusÃ©es, patrimoine' },
              { icon: 'âœ‚ï¸', label: 'Atelier crÃ©atif maison', description: 'RÃ©cup, DIY' },
              { icon: 'ğŸµ', label: 'Ã‰couter playlist / crÃ©er playlist', description: 'Musique gratuite' },
              { icon: 'ğŸ“±', label: 'Photographie smartphone', description: 'Prendre des photos' },
              { icon: 'ğŸ¥¾', label: 'Rando lÃ©gÃ¨re / bord de mer', description: 'Marche accessible' },
              { icon: 'ğŸ²', label: 'Jeux de sociÃ©tÃ© avec amis / famille', description: 'Moments conviviaux' }
            ],
            question: 'L\'activitÃ© que je peux faire cette semaine :',
            conclusion: 'Une activitÃ© qui te fait du bien = plus d\'Ã©nergie pour ton projet (emploi, formation, orientation).'
          }
        ]
      },
      {
        id: 'finances',
        emoji: 'ğŸ’°',
        title: 'FINANCES',
        subtitle: 'Argent & budget',
        className: 'finances',
        activities: [
          {
            id: 'finances_0',
            title: 'Calcul4U - Mon budget simplifiÃ©',
            objective: 'GÃ¨re ton budget facilement avec un outil adaptÃ© aux jeunes',
            type: 'external_link',
            url: 'https://mlpb-tools.github.io/Calcul4U/',
            buttonText: 'AccÃ©der Ã  l\'outil budget',
            description: 'Un calculateur de budget simple et pratique pour gÃ©rer tes revenus et dÃ©penses au quotidien'
          },
          {
            id: 'finances_1',
            title: 'Mes 3 dÃ©penses du mois',
            objective: 'Juste pour voir',
            type: 'expense_selector',
            intro: 'Pas de jugement, juste pour voir oÃ¹ part ton argent.',
            maxSelection: 3,
            expenses: [
              { icon: 'ğŸ›’', label: 'Courses / nourriture', description: 'Alimentation quotidienne' },
              { icon: 'ğŸ“±', label: 'TÃ©lÃ©phone / forfait', description: 'Abonnement mobile' },
              { icon: 'ï¿½ï¿½', label: 'Abonnements', description: 'Netflix, Spotify...' },
              { icon: 'ğŸ‘•', label: 'VÃªtements', description: 'Fringues, chaussures' },
              { icon: 'ğŸšŒ', label: 'Transport / essence', description: 'Bus, train, voiture' },
              { icon: 'ğŸš¬', label: 'Cigarettes', description: 'Tabac' },
              { icon: 'ğŸ‰', label: 'Loisirs / sorties', description: 'Restos, cinÃ©ma, soirÃ©es' },
              { icon: 'ï¿½ï¿½', label: 'ImprÃ©vus', description: 'Trucs qui arrivent' },
              { icon: 'ğŸ ', label: 'Loyer / participation', description: 'Logement' },
              { icon: 'ğŸ•', label: 'Animaux', description: 'Nourriture, vÃ©to' },
              { icon: 'ğŸ®', label: 'Jeux / achats en ligne', description: 'Gaming, shopping web' },
              { icon: 'ğŸ’Š', label: 'Soins / pharmacie', description: 'SantÃ©, mÃ©dicaments' }
            ],
            question: 'Ce qui me coÃ»te le plus, c\'est :',
            conclusion: 'Identifier tes dÃ©penses t\'aide Ã  mieux gÃ©rer ton mois et avancer vers ton projet (permis, logement, formation).'
          },
          {
            id: 'finances_2',
            title: 'Ã‡a rentre / Ã§a sort',
            objective: 'Comprendre les flux',
            type: 'income_expense_sort',
            intro: 'L\'argent, c\'est juste des entrÃ©es et des sorties. Rien de compliquÃ©.',
            items: [
              { label: 'Salaire / petit boulot', category: 'income' },
              { label: 'Aide familiale', category: 'income' },
              { label: 'Aide CAF', category: 'income' },
              { label: 'Aide formation', category: 'income' },
              { label: 'Ventes (Vintedâ€¦)', category: 'income' },
              { label: 'Loyer', category: 'expense' },
              { label: 'Courses', category: 'expense' },
              { label: 'Transport', category: 'expense' },
              { label: 'TÃ©lÃ©phone', category: 'expense' },
              { label: 'Sorties', category: 'expense' },
              { label: 'ImprÃ©vus', category: 'expense' },
              { label: 'SantÃ©', category: 'expense' },
              { label: 'Abonnements', category: 'expense' },
              { label: 'Achats compulsifs', category: 'expense' }
            ],
            question: 'J\'ai plus souvent des soucis avec :',
            options: ['Ce qui rentre', 'Ce qui sort', 'Les deux'],
            conclusion: 'Comprendre tes flux aide Ã  Ã©viter les dettes et Ã  garder un budget stable pour travailler ou te former.'
          },
          {
            id: 'finances_3',
            title: 'Un choix important',
            objective: 'Priorisation alignÃ©e projet',
            type: 'budget_choices',
            intro: 'Parfois, on ne peut pas tout faire. Il faut choisir ce qui t\'aide vraiment.',
            choices: [
              {
                situation: 'Tu as un peu d\'argent de cÃ´tÃ©. Tu choisis :',
                optionA: { icon: 'ğŸ“±', label: 'Nouveau tÃ©lÃ©phone', description: 'Envie immÃ©diate' },
                optionB: { icon: 'ğŸš—', label: 'Permis de conduire', description: 'Aide pour l\'emploi' }
              },
              {
                situation: 'Ce mois-ci, tu dois arbitrer entre :',
                optionA: { icon: 'ğŸ‰', label: 'Sorties / loisirs', description: 'Profiter maintenant' },
                optionB: { icon: 'ğŸ’°', label: 'Mettre un peu d\'argent de cÃ´tÃ©', description: 'SÃ©curitÃ© future' }
              },
              {
                situation: 'Tu as besoin de choisir :',
                optionA: { icon: 'ğŸ‘•', label: 'VÃªtements / achats', description: 'Plaisir immÃ©diat' },
                optionB: { icon: 'ğŸšŒ', label: 'Transport (bus, essence)', description: 'NÃ©cessaire pour bouger' }
              }
            ],
            question: 'Le choix qui m\'aiderait vraiment maintenant :',
            conclusion: 'Faire un choix alignÃ© sur ton projet t\'aide Ã  avancer plus vite (emploi, permis, logementâ€¦).'
          }
        ]
      }
    ];

    let currentDomain = null;
    let currentActivityIndex = 0;
    let userResponses = [];
    let isLoading = true;

    const dataHandler = {
      onDataChanged(data) {
        userResponses = data;
        if (!isLoading) {
          renderCurrentView();
        }
      }
    };

    async function init() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize data SDK");
        return;
      }
      
      isLoading = false;
      renderDomainSelection();
    }

    function renderDomainSelection() {
      const contentArea = document.getElementById('contentArea');
      const completedDomains = getCompletedDomains();
      
      contentArea.innerHTML = `
        <h2 class="section-title">Choisis un domaine</h2>
        <div class="domain-grid">
          ${domains.map(domain => `
            <div class="domain-card ${domain.className}" onclick="selectDomain('${domain.id}')">
              <span class="domain-emoji">${domain.emoji}</span>
              <h3 class="domain-title">${domain.title}</h3>
              <p class="domain-subtitle">${domain.subtitle}</p>
              ${completedDomains.includes(domain.id) ? '<span class="completion-badge">âœ“ TerminÃ©</span>' : ''}
            </div>
          `).join('')}
        </div>
      `;
    }

    function getCompletedDomains() {
      const completed = [];
      domains.forEach(domain => {
        const domainResponses = userResponses.filter(r => r.domain_id === domain.id);
        if (domainResponses.length === domain.activities.length) {
          completed.push(domain.id);
        }
      });
      return completed;
    }

    function selectDomain(domainId) {
      currentDomain = domains.find(d => d.id === domainId);
      currentActivityIndex = 0;
      renderActivity();
    }

    function renderActivity() {
      if (!currentDomain) return;
      
      const activity = currentDomain.activities[currentActivityIndex];
      const contentArea = document.getElementById('contentArea');
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activity.id
      );
      
      let activityContent = '';
      
      switch (activity.type) {
        case 'cards':
          activityContent = renderCardsActivity(activity, existingResponse);
          break;
        case 'flip_cards':
          activityContent = renderFlipCardsActivity(activity, existingResponse);
          break;
        case 'emoji':
          activityContent = renderEmojiActivity(activity, existingResponse);
          break;
        case 'scenarios':
          activityContent = renderScenariosActivity(activity, existingResponse);
          break;
        case 'scenarios_abc':
          activityContent = renderScenariosAbcActivity(activity, existingResponse);
          break;
        case 'sliders':
          activityContent = renderSlidersActivity(activity, existingResponse);
          break;
        case 'slider':
          activityContent = renderSliderActivity(activity, existingResponse);
          break;
        case 'learning_styles':
          activityContent = renderLearningStylesActivity(activity, existingResponse);
          break;
        case 'rhythm_sliders':
          activityContent = renderRhythmSlidersActivity(activity, existingResponse);
          break;
        case 'tool_selection':
          activityContent = renderToolSelectionActivity(activity, existingResponse);
          break;
        case 'drag_sort_categories':
          activityContent = renderDragSortCategoriesActivity(activity, existingResponse);
          break;
        case 'flip_experiences':
          activityContent = renderFlipExperiencesActivity(activity, existingResponse);
          break;
        case 'direction_bubbles':
          activityContent = renderDirectionBubblesActivity(activity, existingResponse);
          break;
        case 'external_link':
          activityContent = renderExternalLinkActivity(activity, existingResponse);
          break;
        case 'signal_selector':
          activityContent = renderSignalSelectorActivity(activity, existingResponse);
          break;
        case 'apaisement_selector':
          activityContent = renderApaisementSelectorActivity(activity, existingResponse);
          break;
        case 'help_resources':
          activityContent = renderHelpResourcesActivity(activity, existingResponse);
          break;
        case 'housing_situation':
          activityContent = renderHousingSituationActivity(activity, existingResponse);
          break;
        case 'security_needs':
          activityContent = renderSecurityNeedsActivity(activity, existingResponse);
          break;
        case 'first_step_housing':
          activityContent = renderFirstStepHousingActivity(activity, existingResponse);
          break;
        case 'group_position_sliders':
          activityContent = renderGroupPositionSlidersActivity(activity, existingResponse);
          break;
        case 'disagreement_scenarios':
          activityContent = renderDisagreementScenariosActivity(activity, existingResponse);
          break;
        case 'rights_flip_cards':
          activityContent = renderRightsFlipCardsActivity(activity, existingResponse);
          break;
        case 'wellbeing_moodboard':
          activityContent = renderWellbeingMoodboardActivity(activity, existingResponse);
          break;
        case 'hobby_skills_flip':
          activityContent = renderHobbySkillsFlipActivity(activity, existingResponse);
          break;
        case 'accessible_activity':
          activityContent = renderAccessibleActivityActivity(activity, existingResponse);
          break;
        case 'expense_selector':
          activityContent = renderExpenseSelectorActivity(activity, existingResponse);
          break;
        case 'income_expense_sort':
          activityContent = renderIncomeExpenseSortActivity(activity, existingResponse);
          break;
        case 'budget_choices':
          activityContent = renderBudgetChoicesActivity(activity, existingResponse);
          break;
      }
      
      contentArea.innerHTML = `
        <div class="progress-indicator">
          <span>Ã‰tape ${currentActivityIndex + 1} sur ${currentDomain.activities.length}</span>
          <span>${currentDomain.title}</span>
        </div>
        
        <div>
          <div class="activity-header">
            <h2 class="activity-title">${activity.title}</h2>
            <p class="activity-objective">ğŸ¯ ${activity.objective}</p>
          </div>
          
          ${activityContent}
          
          <div class="button-group">
            <button class="btn btn-secondary" onclick="goBack()" id="backButton">${defaultConfig.back_button}</button>
            <button class="btn btn-primary" onclick="nextActivity()" id="nextButton" ${!existingResponse ? 'disabled' : ''}>
              ${currentActivityIndex === currentDomain.activities.length - 1 ? defaultConfig.finish_button : defaultConfig.next_button}
            </button>
          </div>
        </div>
      `;
    }

    function renderCardsActivity(activity, existingResponse) {
      const selectedCards = existingResponse ? existingResponse.response.split(',') : [];
      
      return `
        <div class="selection-grid">
          ${activity.options.map((option, idx) => `
            <div class="selection-card ${selectedCards.includes(option) ? 'selected' : ''}" 
                 onclick="toggleCard('${activity.id}', '${option}', this)">
              <div class="selection-label">${option}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderFlipCardsActivity(activity, existingResponse) {
      const selectedSkills = existingResponse ? existingResponse.response.split(',') : [];
      
      return `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2rem; text-align: center;">
          ğŸ’¡ Clique sur les cartes pour dÃ©couvrir tes compÃ©tences professionnelles cachÃ©es !
        </p>
        <div class="flip-cards-grid">
          ${activity.cards.map((card, idx) => `
            <div class="flip-card-wrapper">
              <div class="flip-card ${selectedSkills.includes(card.skill) ? 'is-flipped' : ''}" 
                   onclick="flipCard('${activity.id}', '${card.skill}', this)">
                <div class="flip-card-front">
                  <div class="flip-card-content">
                    <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">${card.recto.split(' ')[0]}</div>
                    <div style="font-weight: 500; font-size: 1rem; line-height: 1.4;">${card.recto.substring(card.recto.indexOf(' ') + 1)}</div>
                  </div>
                </div>
                <div class="flip-card-back">
                  <div class="flip-card-content">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">âœ¨</div>
                    <div style="font-weight: 700; font-size: 1.25rem; font-family: 'Fredoka', sans-serif;">${card.verso}</div>
                  </div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
        <div style="background: #FFF9E6; border-left: 4px solid #FFD600; padding: 1.5rem; border-radius: 12px; margin-top: 2.5rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1.05rem;">
            ï¿½ï¿½ Ces compÃ©tences comptent vraiment pour l'emploi !
          </p>
        </div>
      `;
    }

    function renderEmojiActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response : null;
      
      return `
        <div class="emoji-selector">
          ${activity.options.map(option => `
            <div class="emoji-option ${selected === option.label ? 'selected' : ''}" 
                 onclick="selectEmoji('${activity.id}', '${option.label}', this)">
              <div class="emoji-large">${option.emoji}</div>
              <div class="emoji-text">${option.label}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderScenariosActivity(activity, existingResponse) {
      const responses = existingResponse ? JSON.parse(existingResponse.response) : {};
      
      return activity.scenarios.map((scenario, idx) => `
        <div style="margin-bottom: 2.5rem;">
          <p style="font-weight: 600; color: #212121; margin-bottom: 1.25rem; font-size: 1.125rem;">${scenario.situation}</p>
          ${scenario.options.map((option, optIdx) => `
            <div class="scenario-option ${responses[idx] === option ? 'selected' : ''}"
                 onclick="selectScenario('${activity.id}', ${idx}, '${option.replace(/'/g, "\\'")}', this)">
              ${option}
            </div>
          `).join('')}
        </div>
      `).join('');
    }

    function renderScenariosAbcActivity(activity, existingResponse) {
      const responses = existingResponse ? JSON.parse(existingResponse.response) : {};
      
      return `
        <div class="scenarios-abc-container">
          ${activity.scenarios.map((scenario, idx) => `
            <div class="scenario-abc-item">
              <div class="scenario-question">
                <p class="scenario-question-text">${scenario.situation}</p>
              </div>
              <div class="scenario-abc-options">
                ${scenario.options.map((option, optIdx) => `
                  <div class="scenario-abc-option ${responses[idx] === option.label ? 'selected' : ''}"
                       onclick="selectScenarioAbc('${activity.id}', ${idx}, '${option.label.replace(/'/g, "\\'")}', '${option.feedback.replace(/'/g, "\\'")}', this)">
                    ${option.label}
                  </div>
                `).join('')}
              </div>
              ${responses[idx] ? `
                <div class="scenario-feedback" id="feedback-${activity.id}-${idx}">
                  ${scenario.options.find(o => o.label === responses[idx])?.feedback || ''}
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderSlidersActivity(activity, existingResponse) {
      const values = existingResponse ? JSON.parse(existingResponse.response) : {};
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        ${activity.sliders.map((slider, idx) => `
          <div class="slider-container">
            <label class="slider-label">${slider.label}</label>
            <input type="range" class="slider" min="0" max="100" value="${values[idx] || 50}"
                   oninput="updateSlider('${activity.id}', ${idx}, this.value)">
            <div class="slider-values">
              <span>${slider.min}</span>
              <span>${slider.max}</span>
            </div>
          </div>
        `).join('')}
        <div style="background: #E3F2FD; border-left: 4px solid #00BFA5; padding: 1.5rem; border-radius: 12px; margin-top: 2.5rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1.05rem;">
            ğŸ’¡ Ce que tu viens de choisir t'aidera Ã  trouver un emploi supportable, rÃ©aliste et durable.
          </p>
        </div>
      `;
    }

    function renderSliderActivity(activity, existingResponse) {
      const value = existingResponse ? existingResponse.response : '50';
      
      return `
        <div class="slider-container">
          <label class="slider-label">${activity.slider.label}</label>
          <input type="range" class="slider" min="0" max="100" value="${value}"
                 oninput="updateSingleSlider('${activity.id}', this.value)">
          <div class="slider-values">
            <span>${activity.slider.min}</span>
            <span>${activity.slider.max}</span>
          </div>
        </div>
      `;
    }

    function renderLearningStylesActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split(',') : [];
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';

      const maxSelection = activity.maxSelection || 2;
      const selectedCount = selected.length;
      
      return `
        ${intro}
        <div style="background: #FFF3E0; border-left: 4px solid #FFD600; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            ğŸ’¡ Sï¿½ï¿½ï¿½lectionne jusqu'Ã  ${maxSelection} maniÃ¨res qui te correspondent le mieux
            ${selectedCount > 0 ? ` (${selectedCount}/${maxSelection} sÃ©lectionnÃ©${selectedCount > 1 ? 's' : ''})` : ''}
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.options.map(option => `
            <div class="selection-card ${selected.includes(option.label) ? 'selected' : ''}" 
                 onclick="toggleLearningStyle('${activity.id}', '${option.label.replace(/'/g, "\\'")}', ${maxSelection}, this)"
                 style="padding: 2rem; min-height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${option.icon}</div>
              <div style="font-weight: 700; font-size: 1.25rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${option.label}
              </div>
              <div style="font-size: 0.95rem; color: #616161; line-height: 1.4;">
                ${option.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selectedCount > 0 ? `
          <div style="background: #E8F5E9; border-left: 4px solid #00BFA5; padding: 1.5rem; border-radius: 12px; margin-top: 2.5rem;">
            <p style="font-weight: 700; color: #1B5E20; margin: 0 0 0.75rem 0; font-size: 1.125rem; font-family: 'Fredoka', sans-serif;">
              âœ… Ta maniÃ¨re d'apprendre :
            </p>
            <p style="color: #2E7D32; margin: 0; font-size: 1.05rem; font-weight: 500;">
              ${selected.join(' + ')}
            </p>
            <p style="color: #2E7D32; margin: 0.75rem 0 0 0; font-size: 1rem;">
              ${activity.conclusion}
            </p>
          </div>
        ` : ''}
      `;
    }

    function renderRhythmSlidersActivity(activity, existingResponse) {
      const values = existingResponse ? JSON.parse(existingResponse.response) : {};
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        ${activity.sliders.map((slider, idx) => `
          <div class="slider-container">
            <label class="slider-label">${slider.label}</label>
            <input type="range" class="slider" min="0" max="100" value="${values[idx] || 50}"
                   oninput="updateRhythmSlider('${activity.id}', ${idx}, this.value)">
            <div class="slider-values">
              <span>${slider.min}</span>
              <span>${slider.max}</span>
            </div>
          </div>
        `).join('')}
        ${Object.keys(values).length === activity.sliders.length ? `
          <div style="background: linear-gradient(135deg, #E3F2FD 0%, #E8F5E9 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2.5rem; border: 3px solid #00BFA5;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1.5rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ“Š Ton rythme rÃ©aliste aujourd'hui
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
              ${activity.sliders.map((slider, idx) => {
                const value = parseInt(values[idx] || 50);
                const emoji = slider.label.split(' ')[0];
                return `
                  <div style="background: ${value < 33 ? '#FFD75B' : value < 67 ? '#46D9D2' : '#FF4F73'}; 
                              padding: 0.75rem 1.5rem; border-radius: 25px; color: white; font-weight: 600; font-size: 1rem; font-family: 'Fredoka', sans-serif;">
                    ${emoji} ${value < 33 ? slider.min : value < 67 ? 'Moyen' : slider.max}
                  </div>
                `;
              }).join('')}
            </div>
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1.05rem; text-align: center;">
                ğŸ’¡ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderToolSelectionActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response : null;
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <div style="background: #FFF3E0; border-left: 4px solid #FFD600; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            ğŸ“‹ Choisis l'outil que tu penses pouvoir utiliser cette semaine
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.options.map(option => `
            <div class="selection-card ${selected === option.label ? 'selected' : ''}" 
                 onclick="selectTool('${activity.id}', '${option.label.replace(/'/g, "\\'")}', this)"
                 style="padding: 2rem; min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${option.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${option.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${option.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selected ? `
          <div style="background: linear-gradient(135deg, #FFD75B 0%, #FFB300 100%); padding: 2rem; border-radius: 20px; margin-top: 2.5rem; border: 3px solid #FFD75B;">
            <p style="font-weight: 700; color: #171718; margin: 0 0 0.75rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ¯ Mon engagement
            </p>
            <p style="color: #171718; margin: 0; font-size: 1.125rem; font-weight: 600; text-align: center;">
              L'outil que je peux tester dÃ¨s cette semaine : ${selected}
            </p>
            <div style="background: white; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem; text-align: center;">
                âœ¨ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderDragSortCategoriesActivity(activity, existingResponse) {
      const responses = existingResponse ? JSON.parse(existingResponse.response) : {};
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      let likeCount = 0;
      let topCategories = [];
      
      if (existingResponse) {
        const categoryLikes = {};
        Object.keys(activity.categories).forEach(catKey => {
          categoryLikes[catKey] = 0;
        });
        
        Object.entries(responses).forEach(([item, status]) => {
          if (status === 'like') {
            likeCount++;
            Object.entries(activity.categories).forEach(([catKey, category]) => {
              if (category.items.includes(item)) {
                categoryLikes[catKey]++;
              }
            });
          }
        });
        
        topCategories = Object.entries(categoryLikes)
          .filter(([_, count]) => count > 0)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 2)
          .map(([catKey, _]) => activity.categories[catKey].name);
      }
      
      return `
        ${intro}
        <div class="category-sorter">
          ${Object.entries(activity.categories).map(([catKey, category]) => `
            <div class="category-group">
              <div class="category-name">${category.name}</div>
              <div class="category-items">
                ${category.items.map(item => {
                  const status = responses[item] || '';
                  return `
                    <div class="selection-card ${status}" 
                         onclick="toggleLikeDislike('${activity.id}', '${item.replace(/'/g, "\\'")}', this)">
                      <div class="selection-label" style="font-size: 1.125rem;">${item}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          `).join('')}
        </div>
        ${likeCount > 0 ? `
          <div style="background: linear-gradient(135deg, #E8F5E9 0%, #FFF3E0 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2.5rem; border: 3px solid #00BFA5;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              âœ¨ Ce qui ressort pour toi
            </p>
            ${topCategories.length > 0 ? `
              <p style="color: #212121; margin: 0 0 1.5rem 0; font-size: 1.125rem; font-weight: 600; text-align: center;">
                ${topCategories.join(' + ')}
              </p>
            ` : ''}
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1rem; text-align: center;">
                ğŸ’¡ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderFlipExperiencesActivity(activity, existingResponse) {
      const selectedSkills = existingResponse ? existingResponse.response.split(',') : [];
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <p style="font-size: 1.05rem; color: #616161; margin-bottom: 2rem; text-align: center;">
          ğŸ’¡ Clique sur les cartes pour voir ce que tes expÃ©riences peuvent t'apporter !
        </p>
        <div class="flip-cards-grid">
          ${activity.cards.map((card, idx) => `
            <div class="flip-card-wrapper">
              <div class="flip-card ${selectedSkills.includes(card.skill) ? 'is-flipped' : ''}" 
                   onclick="flipCard('${activity.id}', '${card.skill}', this)">
                <div class="flip-card-front">
                  <div class="flip-card-content">
                    <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">${card.recto.split(' ')[0]}</div>
                    <div style="font-weight: 500; font-size: 0.95rem; line-height: 1.4;">${card.recto.substring(card.recto.indexOf(' ') + 1)}</div>
                  </div>
                </div>
                <div class="flip-card-back">
                  <div class="flip-card-content">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">âœ¨</div>
                    <div style="font-weight: 700; font-size: 1.25rem; font-family: 'Fredoka', sans-serif;">${card.verso}</div>
                  </div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
        <div style="background: #FFD75B; border-left: 4px solid #FFB300; padding: 1.5rem; border-radius: 12px; margin-top: 2.5rem;">
          <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1.05rem;">
            ğŸš€ ${activity.conclusion}
          </p>
        </div>
      `;
    }

    function renderDirectionBubblesActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response : null;
      
      const intro = activity.intro ? `
        <p style="font-size: 1.25rem; color: #212121; margin-bottom: 2.5rem; text-align: center; font-weight: 600;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <div class="direction-bubbles">
          ${activity.options.map(option => `
            <div class="direction-bubble ${selected === option.label ? 'selected' : ''}" 
                 style="${selected === option.label ? `background: linear-gradient(135deg, ${option.color} 0%, ${option.color}DD 100%); border-color: ${option.color};` : ''}"
                 onclick="selectDirection('${activity.id}', '${option.label.replace(/'/g, "\\'")}', '${option.color}', this)">
              <span class="direction-icon">${option.icon}</span>
              <div class="direction-label">${option.label}</div>
              <div class="direction-description">${option.description}</div>
            </div>
          `).join('')}
        </div>
        ${selected ? `
          <div style="background: linear-gradient(135deg, #E8F5E9 0%, #E3F2FD 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2.5rem; border: 3px solid #00BFA5;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ§­ Ta direction : ${selected}
            </p>
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1rem; text-align: center;">
                ğŸ’¡ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderExternalLinkActivity(activity, existingResponse) {
      const visited = existingResponse ? existingResponse.response === 'visited' : false;
      
      return `
        <div style="text-align: center; padding: 2rem;">
          ${activity.description ? `
            <p style="font-size: 1.25rem; color: #424242; margin-bottom: 3rem; line-height: 1.6; font-weight: 500;">
              ${activity.description}
            </p>
          ` : ''}
          
          <div style="background: linear-gradient(135deg, #46D9D2 0%, #00BFA5 100%); padding: 4rem 3rem; border-radius: 30px; margin: 2rem 0; box-shadow: 0 8px 32px rgba(70, 217, 210, 0.3);">
            <div style="font-size: 5rem; margin-bottom: 1.5rem;">ğŸš€</div>
            <a href="${activity.url}" 
               target="_blank" 
               rel="noopener noreferrer"
               onclick="markExternalLinkVisited('${activity.id}')"
               style="display: inline-block; background: white; color: #00BFA5; padding: 1.5rem 3rem; border-radius: 50px; font-size: 1.25rem; font-weight: 700; text-decoration: none; font-family: 'Fredoka', sans-serif; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15); transition: all 0.3s ease;"
               onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(0, 0, 0, 0.2)'"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.15)'">
              ${activity.buttonText}
            </a>
            ${visited ? `
              <div style="margin-top: 2rem; color: white; font-weight: 600; font-size: 1.05rem;">
                âœ“ Lien dÃ©jÃ  visitÃ©
              </div>
            ` : ''}
          </div>
          
          <div style="background: #FFF3E0; border-left: 4px solid #FFD600; padding: 1.5rem; border-radius: 12px; margin-top: 2.5rem;">
            <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1.05rem;">
              ğŸ’¡ Le lien s'ouvrira dans un nouvel onglet. Tu pourras revenir ici ensuite !
            </p>
          </div>
        </div>
      `;
    }

    function renderSignalSelectorActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split(',') : [];
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      const maxSelection = activity.maxSelection || 3;
      const selectedCount = selected.length;
      
      return `
        ${intro}
        <div style="background: #FFE8F0; border-left: 4px solid #FF4F73; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            ğŸ’¡ SÃ©lectionne jusqu'Ã  ${maxSelection} signaux qui te parlent le plus
            ${selectedCount > 0 ? ` (${selectedCount}/${maxSelection} sÃ©lectionnÃ©${selectedCount > 1 ? 's' : ''})` : ''}
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.signals.map(signal => `
            <div class="selection-card ${selected.includes(signal.label) ? 'selected' : ''}" 
                 onclick="toggleSignal('${activity.id}', '${signal.label.replace(/'/g, "\\'")}', ${maxSelection}, this)"
                 style="padding: 2rem; min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${signal.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${signal.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${signal.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selectedCount > 0 ? `
          <div style="background: linear-gradient(135deg, #FFE8F0 0%, #FFD0E5 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2.5rem; border: 3px solid #FF4F73;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ¯ Tes signaux d'alerte
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
              ${selected.map(signal => `
                <div style="background: #FF4F73; padding: 0.75rem 1.5rem; border-radius: 25px; color: white; font-weight: 600; font-size: 1rem; font-family: 'Fredoka', sans-serif;">
                  ${signal}
                </div>
              `).join('')}
            </div>
            <div style="background: white; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1.05rem; text-align: center;">
                âš ï¸ ${activity.conclusion}
              </p>
            </div>
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px; margin-top: 1rem;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1rem; text-align: center;">
                ğŸ’¼ ${activity.insertion_message}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderApaisementSelectorActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split(',') : [];
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <div style="background: #E3F2FD; border-left: 4px solid #46D9D2; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            âœ¨ Clique sur toutes les stratÃ©gies qui t'aident vraiment
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.strategies.map(strategy => `
            <div class="selection-card ${selected.includes(strategy.label) ? 'selected' : ''}" 
                 onclick="toggleApaisement('${activity.id}', '${strategy.label.replace(/'/g, "\\'")}', this)"
                 style="padding: 2rem; min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${strategy.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${strategy.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${strategy.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selected.length > 0 ? `
          <div style="background: linear-gradient(135deg, #E3F2FD 0%, #B3E5FC 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2.5rem; border: 3px solid #46D9D2;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸŒŸ Ce qui m'apaise le plus aujourd'hui
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
              ${selected.map(strategy => `
                <div style="background: #46D9D2; padding: 0.75rem 1.5rem; border-radius: 25px; color: white; font-weight: 600; font-size: 1rem; font-family: 'Fredoka', sans-serif;">
                  ${strategy}
                </div>
              `).join('')}
            </div>
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1rem; text-align: center;">
                ğŸ’¼ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderHelpResourcesActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split('|||')[0].split(',') : [];
      const textAnswer = existingResponse ? existingResponse.response.split('|||')[1] || '' : '';
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      const maxSelection = activity.maxSelection || 3;
      const selectedCount = selected.filter(s => s).length;
      
      return `
        ${intro}
        <div style="background: #E8F5E9; border-left: 4px solid #00BFA5; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            ï¿½ï¿½ï¿½ SÃ©lectionne 1 Ã  ${maxSelection} personnes ressources
            ${selectedCount > 0 ? ` (${selectedCount}/${maxSelection} sÃ©lectionnÃ©${selectedCount > 1 ? 's' : ''})` : ''}
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.resources.map(resource => `
            <div class="selection-card ${selected.includes(resource.label) ? 'selected' : ''}" 
                 onclick="toggleHelpResource('${activity.id}', '${resource.label.replace(/'/g, "\\'")}', ${maxSelection}, this)"
                 style="padding: 2rem; min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${resource.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${resource.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${resource.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selectedCount > 0 ? `
          <div style="background: #FAFAFA; border-radius: 20px; padding: 2rem; margin-top: 2.5rem; border: 3px solid #E0E0E0;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.125rem; font-family: 'Fredoka', sans-serif;">
              ${activity.question}
            </p>
            <input type="text" 
                   id="helpResourceText" 
                   value="${textAnswer}"
                   oninput="updateHelpResourceText('${activity.id}', this.value)"
                   placeholder="Ã‰cris le nom de la personne..."
                   style="width: 100%; padding: 1rem; border: 2px solid #E0E0E0; border-radius: 12px; font-size: 1rem; font-family: 'Poppins', sans-serif; box-sizing: border-box;">
          </div>
          <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2rem; border: 3px solid #00BFA5;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ¤ Tes personnes ressources
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
              ${selected.filter(s => s).map(resource => `
                <div style="background: #00BFA5; padding: 0.75rem 1.5rem; border-radius: 25px; color: white; font-weight: 600; font-size: 1rem; font-family: 'Fredoka', sans-serif;">
                  ${resource}
                </div>
              `).join('')}
            </div>
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1rem; text-align: center;">
                ï¿½ï¿½ï¿½ï¿½ï¸ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    let pendingSave = null;

    async function toggleCard(activityId, option, element) {
      element.classList.toggle('selected');
      
      const allSelected = Array.from(document.querySelectorAll('.selection-card.selected'))
        .map(el => el.querySelector('.selection-label').textContent);
      
      await saveResponse(activityId, allSelected.join(','));
    }

    async function selectEmoji(activityId, label, element) {
      document.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      
      await saveResponse(activityId, label);
    }

    async function selectScenario(activityId, scenarioIdx, option, element) {
      const container = element.parentElement;
      container.querySelectorAll('.scenario-option').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const responses = existingResponse ? JSON.parse(existingResponse.response) : {};
      responses[scenarioIdx] = option;
      
      await saveResponse(activityId, JSON.stringify(responses));
    }

    async function flipCard(activityId, skill, element) {
      element.classList.toggle('is-flipped');
      
      const allFlipped = Array.from(document.querySelectorAll('.flip-card.is-flipped'))
        .map(el => el.getAttribute('onclick').match(/'([^']+)'/g)[1].replace(/'/g, ''));
      
      await saveResponse(activityId, allFlipped.join(','));
    }

    async function selectScenarioAbc(activityId, scenarioIdx, label, feedback, element) {
      const container = element.parentElement;
      container.querySelectorAll('.scenario-abc-option').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const responses = existingResponse ? JSON.parse(existingResponse.response) : {};
      responses[scenarioIdx] = label;
      
      const feedbackElement = document.getElementById(`feedback-${activityId}-${scenarioIdx}`);
      if (feedbackElement) {
        feedbackElement.textContent = feedback;
      } else {
        const scenarioItem = element.closest('.scenario-abc-item');
        const newFeedback = document.createElement('div');
        newFeedback.className = 'scenario-feedback';
        newFeedback.id = `feedback-${activityId}-${scenarioIdx}`;
        newFeedback.textContent = feedback;
        scenarioItem.appendChild(newFeedback);
      }
      
      await saveResponse(activityId, JSON.stringify(responses));
    }

    async function updateSlider(activityId, sliderIdx, value) {
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const values = existingResponse ? JSON.parse(existingResponse.response) : {};
      values[sliderIdx] = value;
      
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, JSON.stringify(values)), 500);
    }

    async function updateSingleSlider(activityId, value) {
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, value), 500);
    }

    async function toggleLearningStyle(activityId, label, maxSelection, element) {
      const container = element.parentElement;
      const allSelected = Array.from(container.querySelectorAll('.selection-card.selected'));
      
      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
      } else {
        if (allSelected.length >= maxSelection) {
          const instructionDiv = container.previousElementSibling;
          if (instructionDiv) {
            instructionDiv.style.background = '#FFEBEE';
            instructionDiv.style.borderColor = '#FF1744';
            setTimeout(() => {
              instructionDiv.style.background = '#FFF3E0';
              instructionDiv.style.borderColor = '#FFD600';
            }, 1000);
          }
          return;
        }
        element.classList.add('selected');
      }
      
      const selected = Array.from(container.querySelectorAll('.selection-card.selected'))
        .map(el => el.querySelector('div[style*="font-weight: 700"]').textContent.trim());
      
      await saveResponse(activityId, selected.join(','));
    }

    async function updateRhythmSlider(activityId, sliderIdx, value) {
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const values = existingResponse ? JSON.parse(existingResponse.response) : {};
      values[sliderIdx] = value;
      
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, JSON.stringify(values)), 500);
    }

    async function selectTool(activityId, label, element) {
      const container = element.parentElement;
      container.querySelectorAll('.selection-card').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      
      await saveResponse(activityId, label);
    }

    async function toggleLikeDislike(activityId, item, element) {
      if (element.classList.contains('like')) {
        element.classList.remove('like');
        element.classList.add('dislike');
      } else if (element.classList.contains('dislike')) {
        element.classList.remove('dislike');
      } else {
        element.classList.add('like');
      }
      
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const responses = existingResponse ? JSON.parse(existingResponse.response) : {};
      
      if (element.classList.contains('like')) {
        responses[item] = 'like';
      } else if (element.classList.contains('dislike')) {
        responses[item] = 'dislike';
      } else {
        delete responses[item];
      }
      
      await saveResponse(activityId, JSON.stringify(responses));
    }

    async function selectDirection(activityId, label, color, element) {
      const container = element.parentElement;
      container.querySelectorAll('.direction-bubble').forEach(el => {
        el.classList.remove('selected');
        el.style.background = '';
        el.style.borderColor = '';
      });
      
      element.classList.add('selected');
      element.style.background = `linear-gradient(135deg, ${color} 0%, ${color}DD 100%)`;
      element.style.borderColor = color;
      
      await saveResponse(activityId, label);
    }

    async function markExternalLinkVisited(activityId) {
      await saveResponse(activityId, 'visited');
    }

    async function toggleSignal(activityId, label, maxSelection, element) {
      const container = element.parentElement;
      const allSelected = Array.from(container.querySelectorAll('.selection-card.selected'));
      
      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
      } else {
        if (allSelected.length >= maxSelection) {
          const instructionDiv = container.previousElementSibling;
          if (instructionDiv) {
            instructionDiv.style.background = '#FFEBEE';
            instructionDiv.style.borderColor = '#FF1744';
            setTimeout(() => {
              instructionDiv.style.background = '#FFE8F0';
              instructionDiv.style.borderColor = '#FF4F73';
            }, 1000);
          }
          return;
        }
        element.classList.add('selected');
      }
      
      const selected = Array.from(container.querySelectorAll('.selection-card.selected'))
        .map(el => el.querySelector('div[style*="font-weight: 700"]').textContent.trim());
      
      await saveResponse(activityId, selected.join(','));
    }

    async function toggleApaisement(activityId, label, element) {
      element.classList.toggle('selected');
      
      const container = element.parentElement;
      const selected = Array.from(container.querySelectorAll('.selection-card.selected'))
        .map(el => el.querySelector('div[style*="font-weight: 700"]').textContent.trim());
      
      await saveResponse(activityId, selected.join(','));
    }

    async function toggleHelpResource(activityId, label, maxSelection, element) {
      const container = element.parentElement;
      const allSelected = Array.from(container.querySelectorAll('.selection-card.selected'));
      
      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
      } else {
        if (allSelected.length >= maxSelection) {
          const instructionDiv = container.previousElementSibling;
          if (instructionDiv) {
            instructionDiv.style.background = '#FFEBEE';
            instructionDiv.style.borderColor = '#FF1744';
            setTimeout(() => {
              instructionDiv.style.background = '#E8F5E9';
              instructionDiv.style.borderColor = '#00BFA5';
            }, 1000);
          }
          return;
        }
        element.classList.add('selected');
      }
      
      const selected = Array.from(container.querySelectorAll('.selection-card.selected'))
        .map(el => el.querySelector('div[style*="font-weight: 700"]').textContent.trim());
      
      const textInput = document.getElementById('helpResourceText');
      const textValue = textInput ? textInput.value : '';
      
      await saveResponse(activityId, `${selected.join(',')}|||${textValue}`);
    }

    async function updateHelpResourceText(activityId, textValue) {
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const selected = existingResponse ? existingResponse.response.split('|||')[0] : '';
      
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, `${selected}|||${textValue}`), 500);
    }

    function renderHousingSituationActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split('|||')[0] : null;
      const textAnswer = existingResponse ? existingResponse.response.split('|||')[1] || '' : '';
      
      const intro = activity.intro ? `
        <p style="font-size: 1.125rem; color: #424242; margin-bottom: 2.5rem; text-align: center; font-weight: 500;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <div style="background: #E8F5E9; border-left: 4px solid #00BFA5; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            ğŸ  Choisis la situation qui correspond le mieux Ã  ta rÃ©alitÃ© aujourd'hui
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.situations.map(situation => `
            <div class="selection-card ${selected === situation.label ? 'selected' : ''}" 
                 onclick="selectHousingSituation('${activity.id}', '${situation.label.replace(/'/g, "\\'")}', this)"
                 style="padding: 2rem; min-height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${situation.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${situation.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${situation.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selected ? `
          <div style="background: #FAFAFA; border-radius: 20px; padding: 2rem; margin-top: 2.5rem; border: 3px solid #E0E0E0;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.125rem; font-family: 'Fredoka', sans-serif;">
              ${activity.question}
            </p>
            <input type="text" 
                   id="housingSituationText" 
                   value="${textAnswer}"
                   oninput="updateHousingSituationText('${activity.id}', this.value)"
                   placeholder="DÃ©cris ta situation en quelques mots..."
                   style="width: 100%; padding: 1rem; border: 2px solid #E0E0E0; border-radius: 12px; font-size: 1rem; font-family: 'Poppins', sans-serif; box-sizing: border-box;">
          </div>
          <div style="background: linear-gradient(135deg, #FFD75B 0%, #FFB300 100%); padding: 2rem; border-radius: 20px; margin-top: 2rem; border: 3px solid #FFD75B;">
            <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1.05rem; text-align: center;">
              ğŸ¯ ${activity.insertion_message}
            </p>
          </div>
        ` : ''}
      `;
    }

    async function selectHousingSituation(activityId, label, element) {
      const container = element.parentElement;
      container.querySelectorAll('.selection-card').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      
      const textInput = document.getElementById('housingSituationText');
      const textValue = textInput ? textInput.value : '';
      
      await saveResponse(activityId, `${label}|||${textValue}`);
    }

    async function updateHousingSituationText(activityId, textValue) {
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const selected = existingResponse ? existingResponse.response.split('|||')[0] : '';
      
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, `${selected}|||${textValue}`), 500);
    }

    function renderSecurityNeedsActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split('|||')[0].split(',') : [];
      const textAnswer = existingResponse ? existingResponse.response.split('|||')[1] || '' : '';
      
      const intro = activity.intro ? `
        <p style="font-size: 1.25rem; color: #212121; margin-bottom: 2.5rem; text-align: center; font-weight: 600;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <div style="background: #FFF3E0; border-left: 4px solid #FFD75B; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            âœ¨ Clique sur les Ã©lÃ©ments qui sont vraiment importants pour toi (4 Ã  6 Ã©lÃ©ments)
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.needs.map(need => `
            <div class="selection-card ${selected.includes(need.label) ? 'selected' : ''}" 
                 onclick="toggleSecurityNeed('${activity.id}', '${need.label.replace(/'/g, "\\'")}', this)"
                 style="padding: 2rem; min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${need.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${need.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${need.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selected.length > 0 ? `
          <div style="background: #FAFAFA; border-radius: 20px; padding: 2rem; margin-top: 2.5rem; border: 3px solid #E0E0E0;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.125rem; font-family: 'Fredoka', sans-serif;">
              ${activity.question}
            </p>
            <input type="text" 
                   id="securityNeedsText" 
                   value="${textAnswer}"
                   oninput="updateSecurityNeedsText('${activity.id}', this.value)"
                   placeholder="ComplÃ¨te avec tes mots..."
                   style="width: 100%; padding: 1rem; border: 2px solid #E0E0E0; border-radius: 12px; font-size: 1rem; font-family: 'Poppins', sans-serif; box-sizing: border-box;">
          </div>
          <div style="background: linear-gradient(135deg, #FFD75B 0%, #FFB300 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2rem; border: 3px solid #FFD75B;">
            <p style="font-weight: 700; color: #171718; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ¡ Ce qui compte pour toi
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
              ${selected.filter(s => s).map(need => `
                <div style="background: #171718; padding: 0.75rem 1.5rem; border-radius: 25px; color: #FFD75B; font-weight: 600; font-size: 1rem; font-family: 'Fredoka', sans-serif;">
                  ${need}
                </div>
              `).join('')}
            </div>
            <div style="background: white; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem; text-align: center;">
                ğŸ’¡ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    async function toggleSecurityNeed(activityId, label, element) {
      element.classList.toggle('selected');
      
      const container = element.parentElement;
      const selected = Array.from(container.querySelectorAll('.selection-card.selected'))
        .map(el => el.querySelector('div[style*="font-weight: 700"]').textContent.trim());
      
      const textInput = document.getElementById('securityNeedsText');
      const textValue = textInput ? textInput.value : '';
      
      await saveResponse(activityId, `${selected.join(',')}|||${textValue}`);
    }

    async function updateSecurityNeedsText(activityId, textValue) {
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const selected = existingResponse ? existingResponse.response.split('|||')[0] : '';
      
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, `${selected}|||${textValue}`), 500);
    }

    function renderFirstStepHousingActivity(activity, existingResponse) {
      const selected = existingResponse ? existingResponse.response.split('|||')[0] : null;
      const textAnswer = existingResponse ? existingResponse.response.split('|||')[1] || '' : '';
      
      const intro = activity.intro ? `
        <p style="font-size: 1.25rem; color: #212121; margin-bottom: 2.5rem; text-align: center; font-weight: 600;">
          ${activity.intro}
        </p>
      ` : '';
      
      return `
        ${intro}
        <div style="background: #E3F2FD; border-left: 4px solid #46D9D2; padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem;">
          <p style="font-weight: 600; color: #212121; margin: 0; font-size: 1rem;">
            ğŸš¶ Choisis un petit pas que tu te sens capable de faire cette semaine
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
          ${activity.steps.map(step => `
            <div class="selection-card ${selected === step.label ? 'selected' : ''}" 
                 onclick="selectFirstStepHousing('${activity.id}', '${step.label.replace(/'/g, "\\'")}', this)"
                 style="padding: 2rem; min-height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
              <div style="font-size: 3.5rem; margin-bottom: 1rem;">${step.icon}</div>
              <div style="font-weight: 700; font-size: 1.125rem; color: #212121; margin-bottom: 0.5rem; font-family: 'Fredoka', sans-serif;">
                ${step.label}
              </div>
              <div style="font-size: 0.9rem; color: #616161; line-height: 1.4;">
                ${step.description}
              </div>
            </div>
          `).join('')}
        </div>
        ${selected ? `
          <div style="background: #FAFAFA; border-radius: 20px; padding: 2rem; margin-top: 2.5rem; border: 3px solid #E0E0E0;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.125rem; font-family: 'Fredoka', sans-serif;">
              ${activity.question}
            </p>
            <input type="text" 
                   id="firstStepHousingText" 
                   value="${textAnswer}"
                   oninput="updateFirstStepHousingText('${activity.id}', this.value)"
                   placeholder="Note ton petit pas ici..."
                   style="width: 100%; padding: 1rem; border: 2px solid #E0E0E0; border-radius: 12px; font-size: 1rem; font-family: 'Poppins', sans-serif; box-sizing: border-box;">
          </div>
          <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); padding: 2.5rem; border-radius: 20px; margin-top: 2rem; border: 3px solid #00BFA5;">
            <p style="font-weight: 700; color: #212121; margin: 0 0 1rem 0; font-size: 1.25rem; font-family: 'Fredoka', sans-serif; text-align: center;">
              ğŸ¯ Mon petit pas : ${selected}
            </p>
            <div style="background: #FFD75B; padding: 1.25rem; border-radius: 12px; margin-top: 1.5rem;">
              <p style="font-weight: 600; color: #171718; margin: 0; font-size: 1rem; text-align: center;">
                ğŸ¯ ${activity.conclusion}
              </p>
            </div>
          </div>
        ` : ''}
      `;
    }

    async function selectFirstStepHousing(activityId, label, element) {
      const container = element.parentElement;
      container.querySelectorAll('.selection-card').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      
      const textInput = document.getElementById('firstStepHousingText');
      const textValue = textInput ? textInput.value : '';
      
      await saveResponse(activityId, `${label}|||${textValue}`);
    }

    async function updateFirstStepHousingText(activityId, textValue) {
      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );
      
      const selected = existingResponse ? existingResponse.response.split('|||')[0] : '';
      
      if (pendingSave) clearTimeout(pendingSave);
      pendingSave = setTimeout(() => saveResponse(activityId, `${selected}|||${textValue}`), 500);
    }

    function renderGroupPositionSlidersActivity(activity, existingResponse) {
      return `<p>ActivitÃ© en construction</p>`;
    }

    function renderDisagreementScenariosActivity(activity, existingResponse) {
      return renderScenariosAbcActivity(activity, existingResponse);
    }

    function renderRightsFlipCardsActivity(activity, existingResponse) {
      return `<p>ActivitÃ© en construction</p>`;
    }

    function renderWellbeingMoodboardActivity(activity, existingResponse) {
      return `<p>ActivitÃ© en construction</p>`;
    }

    function renderHobbySkillsFlipActivity(activity, existingResponse) {
      return renderFlipCardsActivity(activity, existingResponse);
    }

    function renderAccessibleActivityActivity(activity, existingResponse) {
      return renderToolSelectionActivity(activity, existingResponse);
    }

    function renderExpenseSelectorActivity(activity, existingResponse) {
      return renderSignalSelectorActivity(activity, existingResponse);
    }

    function renderIncomeExpenseSortActivity(activity, existingResponse) {
      return `<p>ActivitÃ© en construction</p>`;
    }

    function renderBudgetChoicesActivity(activity, existingResponse) {
      return `<p>ActivitÃ© en construction</p>`;
    }

    async function saveResponse(activityId, response) {
      if (userResponses.length >= 999) {
        alert("Limite de 999 rÃ©ponses atteinte. Impossible d'ajouter de nouvelles rÃ©ponses.");
        return;
      }

      const existingResponse = userResponses.find(r => 
        r.domain_id === currentDomain.id && r.activity_id === activityId
      );

      if (existingResponse) {
        existingResponse.response = response;
        const result = await window.dataSdk.update(existingResponse);
        if (!result.isOk) {
          console.error("Failed to update response");
        }
      } else {
        const result = await window.dataSdk.create({
          domain_id: currentDomain.id,
          activity_id: activityId,
          response: response,
          completed_at: new Date().toISOString()
        });
        if (!result.isOk) {
          console.error("Failed to create response");
        }
      }

      const nextButton = document.getElementById('nextButton');
      if (nextButton) {
        nextButton.disabled = false;
      }
    }

    function goBack() {
      if (currentActivityIndex > 0) {
        currentActivityIndex--;
        renderActivity();
      } else {
        currentDomain = null;
        renderDomainSelection();
      }
    }

    function nextActivity() {
      if (currentActivityIndex < currentDomain.activities.length - 1) {
        currentActivityIndex++;
        renderActivity();
      } else {
        currentDomain = null;
        renderDomainSelection();
      }
    }

    function renderCurrentView() {
      if (currentDomain) {
        renderActivity();
      } else {
        renderDomainSelection();
      }
    }

    async function onConfigChange(config) {
      document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
      document.getElementById('subtitle').textContent = config.subtitle || defaultConfig.subtitle;
      
      document.body.style.background = config.background_color || defaultConfig.background_color;
      
      const buttons = document.querySelectorAll('.btn');
      buttons.forEach(btn => {
        if (btn.classList.contains('btn-primary')) {
          btn.style.background = `linear-gradient(135deg, ${config.accent_red || defaultConfig.accent_red} 0%, #D50000 100%)`;
        }
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                window.elementSdk.config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.accent_red || defaultConfig.accent_red,
              set: (value) => {
                window.elementSdk.config.accent_red = value;
                window.elementSdk.setConfig({ accent_red: value });
              }
            },
            {
              get: () => config.accent_yellow || defaultConfig.accent_yellow,
              set: (value) => {
                window.elementSdk.config.accent_yellow = value;
                window.elementSdk.setConfig({ accent_yellow: value });
              }
            },
            {
              get: () => config.accent_turquoise || defaultConfig.accent_turquoise,
              set: (value) => {
                window.elementSdk.config.accent_turquoise = value;
                window.elementSdk.setConfig({ accent_turquoise: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                window.elementSdk.config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              window.elementSdk.config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              window.elementSdk.config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["main_title", config.main_title || defaultConfig.main_title],
          ["subtitle", config.subtitle || defaultConfig.subtitle],
          ["start_button", config.start_button || defaultConfig.start_button],
          ["next_button", config.next_button || defaultConfig.next_button],
          ["back_button", config.back_button || defaultConfig.back_button],
          ["finish_button", config.finish_button || defaultConfig.finish_button]
        ])
      });
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a83d86f11bc02d7',t:'MTc2NDc3MzEwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
